
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ProMan â€” Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Add Font Awesome for better icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* CSS Variables for Light/Dark Themes */
      /* CSS Variables for Light/Dark Themes */
:root {
    /* Light Theme (Default) */
    --bg: #f5f6f7;
    --surface: #ffffff;
    --muted: #eef0f2;
    --text: #2f3337;
    --muted-text: #6b7378;
    --accent: #D4AF37;
    --accent-dark: #b8892a;
    --sidebar-bg: #f1f3f4;
    --card-bg: #ffffff;
    --table-header-bg: rgba(212,175,55,0.1);
    --table-row-even: rgba(212,175,55,0.02);
    --table-row-hover: rgba(212,175,55,0.05);
    --table-border: rgba(212,175,55,0.3);
    --modal-bg: #ffffff;
    --modal-text: #2f3337;
    --error-bg: #fef2f2;
    --error-text: #991b1b;
    --success-bg: #f0fdf4;
    --success-text: #166534;
    --warning-bg: #fffbeb;
    --warning-text: #92400e;
    --glass: rgba(255,255,255,0.6);
    --error: #dc2626;
    --error-light: #fef2f2;
}

body.dark {
    /* Dark Theme */
    --bg: #0f172a;
    --surface: #1e293b;
    --muted: #334155;
    --text: #f1f5f9;
    --muted-text: #94a3b8;
    --accent: #F4B342;
    --accent-dark: #E0A028;
    --sidebar-bg: #1e293b;
    --card-bg: #1e293b;
    --table-header-bg: rgba(244, 179, 66, 0.15);
    --table-row-even: rgba(244, 179, 66, 0.05);
    --table-row-hover: rgba(244, 179, 66, 0.1);
    --table-border: rgba(244, 179, 66, 0.3);
    --modal-bg: #1e293b;
    --modal-text: #f1f5f9;
    --error-bg: #450a0a;
    --error-text: #fca5a5;
    --success-bg: #052e16;
    --success-text: #86efac;
    --warning-bg: #451a03;
    --warning-text: #fdba74;
    --glass: rgba(30, 41, 59, 0.6);
    --error: #f87171;
    --error-light: #450a0a;
}

/* Base Styles */
html, body {
    height: 100%;
    scroll-behavior: smooth;
}

body {
    margin: 0;
    min-height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    display: flex;
    flex-direction: column;
    transition: background-color 0.3s ease, color 0.3s ease;
}

/* IMPROVED: Better focus states for accessibility */
:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* NEW: Header styling matching the second header */
header {
    background: var(--surface);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    position: sticky;
    top: 0;
    z-index: 50;
    transition: background-color 0.3s ease;
    height: 64px; /* Fixed header height */
}

header .max-w-6xl {
    max-width: 72rem;
    padding: 0 1.5rem;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 100%;
}

header .flex.items-center.gap-3 a {
    display: flex;
    align-items: center;
    text-decoration: none;
}

header img {
    height: 48px; /* Reduced for compact header */
    width: auto;
    object-fit: contain;
}

@media (min-width: 768px) {
    header img {
        height: 52px;
    }
}

@media (min-width: 1024px) {
    header img {
        height: 56px;
    }
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

/* Header button styles */
.login-btn {
    color: var(--text);
    border-color: var(--muted);
    background: var(--surface);
    border-width: 2px;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: 600;
    font-size: 0.875rem;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-block;
}

.login-btn:hover {
    background: var(--muted);
}

.signup-btn {
    background: var(--accent);
    color: #2b1f00;
    padding: 0.5rem 1.25rem;
    border-radius: 0.5rem;
    font-weight: 700;
    font-size: 0.875rem;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-block;
    border: none;
    cursor: pointer;
}

body.dark .signup-btn {
    color: #1a1400;
}

.signup-btn:hover {
    background: var(--accent-dark);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

/* Dark mode toggle button */
.theme-toggle {
    transition: all 0.2s ease;
    background: var(--muted);
    color: var(--text);
    border: 1px solid var(--muted);
    border-radius: 0.5rem;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    flex-shrink: 0;
}

.theme-toggle:hover {
    background: var(--accent);
    color: #2b1f00;
    border-color: var(--accent);
    transform: translateY(-2px);
}

body.dark .theme-toggle:hover {
    color: #1a1400;
}

/* Mobile Menu Button Styles */
#mobile-menu-button {
    display: none;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    border-radius: 0.5rem;
    background: var(--surface);
    border: 1px solid var(--muted);
    color: var(--text);
    cursor: pointer;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

#mobile-menu-button:hover {
    background: var(--muted);
}

.mobile-menu-icon {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    width: 1.25rem;
}

.mobile-menu-icon span {
    display: block;
    height: 2px;
    width: 100%;
    background: var(--text);
    transition: all 0.3s ease;
    border-radius: 2px;
}

/* Hamburger to X animation */
#mobile-menu-button[aria-expanded="true"] .mobile-menu-icon span:nth-child(1) {
    transform: rotate(45deg) translate(4px, 4px);
}

#mobile-menu-button[aria-expanded="true"] .mobile-menu-icon span:nth-child(2) {
    opacity: 0;
}

#mobile-menu-button[aria-expanded="true"] .mobile-menu-icon span:nth-child(3) {
    transform: rotate(-45deg) translate(4px, -4px);
}

/* Mobile menu styling */
#mobile-menu {
    background: var(--surface);
    border-top: 1px solid var(--muted);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    z-index: 40;
}

body.dark #mobile-menu {
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

/* Show mobile menu button on mobile/tablet, hide desktop nav */
@media (max-width: 1024px) {
    #mobile-menu-button {
        display: flex;
    }

    #nav-links {
        display: none;
    }
}

@media (min-width: 1025px) {
    #mobile-menu-button {
        display: none;
    }
}

/* Main layout - FIXED FOR DESKTOP */
.main-wrap {
    display: flex;
    flex: 1;
    min-height: calc(100vh - 64px); /* Subtract header height */
}

/* FIXED: Sidebar positioned under header with proper spacing */
.sidebar {
    width: 260px;
    height: calc(100vh - 64px); /* Subtract header height */
    position: fixed;
    left: 0;
    top: 64px; /* Start below header */
    z-index: 40;
    overflow-y: auto;
    overflow-x: hidden;
    background: var(--sidebar-bg);
    transition: transform .28s ease, box-shadow .28s ease, background-color 0.3s ease;
    border-right: 1px solid var(--muted);
    transform: translateX(0);
    display: flex;
    flex-direction: column;
    scrollbar-width: thin;
    scrollbar-color: var(--accent) transparent;
}

.sidebar::-webkit-scrollbar {
    width: 6px;
}

.sidebar::-webkit-scrollbar-track {
    background: transparent;
}

.sidebar::-webkit-scrollbar-thumb {
    background-color: var(--accent);
    border-radius: 3px;
}

.sidebar-content {
    flex: 1;
    padding: 1.5rem; /* Restore proper padding */
    display: flex;
    flex-direction: column;
    gap: 1.5rem; /* Restore proper gap */
}

/* Desktop layout - FIXED */
@media (min-width: 1025px) {
    .content {
        margin-left: 260px;
        padding: 2.5rem;
        width: calc(100% - 260px);
        min-height: calc(100vh - 64px); /* Fill space below header */
        box-sizing: border-box;
    }
    #sidebar-backdrop { display: none; }
    #mobile-menu-button { display: none; }

    /* Restore desktop navigation */
    #nav-links {
        display: flex !important;
    }
}

/* Mobile overlay behavior */
@media (max-width: 1024px) {
    .sidebar {
        transform: translateX(-100%);
        position: fixed;
        height: calc(100vh - 64px);
        left: 0;
        top: 64px;
        box-shadow: 0 18px 40px rgba(16,24,40,0.12);
        width: 85%;
        max-width: 320px;
        z-index: 60;
    }
    body.dark .sidebar {
        box-shadow: 0 18px 40px rgba(0,0,0,0.4);
    }
    .sidebar.overlay-visible {
        transform: translateX(0);
        background: var(--sidebar-bg);
    }
    .content {
        margin-left: 0;
        padding: 1.5rem;
        width: 100%;
        min-height: calc(100vh - 64px);
    }
    #sidebar-backdrop {
        display: block;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.45);
        z-index: 55;
        opacity: 0;
        pointer-events: none;
        transition: opacity .18s ease;
        top: 64px;
        height: calc(100vh - 64px);
    }
    #sidebar-backdrop.visible {
        opacity: 1;
        pointer-events: auto;
    }

    header .max-w-6xl {
        padding: 0 1rem;
    }
}

/* IMPROVED: Better sidebar cards with interactive states */
.sidebar .card {
    background: var(--surface);
    border: 1px solid var(--muted);
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    border-left: 4px solid var(--accent);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    position: relative;
    overflow: hidden;
    padding: 1rem; /* Restore proper padding */
    border-radius: 0.75rem;
}

.sidebar .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    transform: translateX(-100%);
    transition: transform 0.6s ease;
}

.sidebar .card:hover::before {
    transform: translateX(100%);
}

body.dark .sidebar .card {
    border-left: 4px solid var(--accent);
}

.sidebar .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    border-color: var(--accent);
}

body.dark .sidebar .card:hover {
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
}

/* IMPROVED: Feature icons with better visual hierarchy */
.feature-icon {
    width: 48px; /* Restore original size */
    height: 48px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(212,175,55,0.08));
    color: var(--accent);
    transition: all 0.3s ease;
    font-size: 1.25rem; /* Restore original size */
}

.sidebar-stats .card:hover .feature-icon {
    transform: scale(1.1) rotate(5deg);
    background: linear-gradient(135deg, rgba(212,175,55,0.25), rgba(212,175,55,0.15));
}

body.dark .feature-icon {
    background: linear-gradient(135deg, rgba(244, 179, 66, 0.15), rgba(244, 179, 66, 0.08));
}

/* IMPROVED: Navigation items with better affordances */
.nav-item {
    display: flex;
    align-items: center;
    gap: 0.875rem;
    padding: 0.875rem 1rem;
    border-radius: 10px;
    color: var(--text);
    text-decoration: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: transparent;
    border: 1px solid transparent;
    position: relative;
    overflow: hidden;
}

.nav-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--accent);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.nav-item > * {
    position: relative;
    z-index: 1;
}

body.dark .nav-item {
    background: transparent;
}

.nav-item:hover {
    background: rgba(212,175,55,0.08);
    border-color: rgba(212,175,55,0.3);
    color: var(--text);
    box-shadow: 0 4px 12px rgba(212,175,55,0.1);
    transform: translateX(4px);
}

body.dark .nav-item:hover {
    background: rgba(244, 179, 66, 0.08);
    border-color: rgba(244, 179, 66, 0.3);
    box-shadow: 0 4px 12px rgba(244, 179, 66, 0.1);
}

.nav-item.active {
    background: rgba(212,175,55,0.12);
    border: 1px solid rgba(212,175,55,0.4);
    color: var(--text);
    box-shadow: 0 4px 12px rgba(212,175,55,0.15);
    font-weight: 600;
}

body.dark .nav-item.active {
    background: rgba(244, 179, 66, 0.12);
    border-color: rgba(244, 179, 66, 0.4);
    box-shadow: 0 4px 12px rgba(244, 179, 66, 0.15);
}

.nav-item.active::after {
    content: '';
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* IMPROVED: Card surfaces with better depth */
.card-surface {
    background: var(--surface);
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(16,24,40,0.08);
    padding: 2rem;
    border: 1px solid var(--muted);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    margin-bottom: 1.5rem;
}

.card-surface:hover {
    box-shadow: 0 15px 40px rgba(16,24,40,0.12);
}

body.dark .card-surface {
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

body.dark .card-surface:hover {
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
}

/* IMPROVED: Table with better visual hierarchy */
.units-wrapper {
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    max-width: 100%;
    border-radius: 12px;
    border: 1px solid var(--muted);
}

.units-wrapper::-webkit-scrollbar {
    height: 8px;
}

.units-wrapper::-webkit-scrollbar-track {
    background: var(--muted);
    border-radius: 4px;
}

.units-wrapper::-webkit-scrollbar-thumb {
    background-color: var(--accent);
    border-radius: 4px;
}

.units-table {
    width: 100%;
    min-width: 760px;
    border-collapse: separate;
    border-spacing: 0;
    border-radius: 12px;
    overflow: hidden;
}

.units-table thead th {
    background: var(--table-header-bg);
    color: var(--text);
    font-weight: 700;
    padding: 1.25rem 1.5rem;
    text-align: left;
    border-bottom: 2px solid var(--table-border);
    position: sticky;
    top: 0;
    z-index: 10;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.units-table thead th:first-child {
    border-top-left-radius: 12px;
}

.units-table thead th:last-child {
    border-top-right-radius: 12px;
}

.units-table tbody td {
    background: var(--surface);
    padding: 1.125rem 1.5rem;
    border-bottom: 1px solid var(--muted);
    color: var(--text);
    white-space: nowrap;
    transition: all 0.2s ease;
}

.units-table tbody tr:last-child td {
    border-bottom: none;
}

.units-table tbody tr:last-child td:first-child {
    border-bottom-left-radius: 12px;
}

.units-table tbody tr:last-child td:last-child {
    border-bottom-right-radius: 12px;
}

.units-table tbody tr:hover td {
    background: var(--table-row-hover);
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.units-table tbody tr:nth-child(even) td {
    background: var(--table-row-even);
}

/* IMPROVED: Status indicators with better affordances */
.indicator {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.25rem;
    height: 2.25rem;
    border-radius: 10px;
    font-weight: 700;
    font-size: 1.125rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.indicator::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.1);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.indicator:hover::before {
    opacity: 1;
}

.indicator:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.indicator.bg-red-100, .indicator.bg-red {
    background: linear-gradient(135deg, #fee2e2, #fecaca);
    color: #991b1b;
    border: 2px solid #fca5a5;
}

body.dark .indicator.bg-red-100, body.dark .indicator.bg-red {
    background: linear-gradient(135deg, rgba(239,68,68,0.2), rgba(239,68,68,0.1));
    color: #fca5a5;
    border: 2px solid rgba(239,68,68,0.3);
}

.indicator.bg-green-100, .indicator.bg-green {
    background: linear-gradient(135deg, #d1fae5, #a7f3d0);
    color: #065f46;
    border: 2px solid #34d399;
}

body.dark .indicator.bg-green-100, body.dark .indicator.bg-green {
    background: linear-gradient(135deg, rgba(34,197,94,0.2), rgba(34,197,94,0.1));
    color: #86efac;
    border: 2px solid rgba(34,197,94,0.3);
}

.control-btn {
    padding: .875rem 1.25rem;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.control-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* IMPROVED: Row selection with better visual feedback */
.row-selected {
    background-color: rgba(212,175,55,0.15) !important;
    outline: 3px solid var(--accent);
    outline-offset: -3px;
    position: relative;
}

.row-selected::after {
    content: 'âœ“';
    position: absolute;
    right: 1rem;
    color: var(--accent);
    font-weight: bold;
    font-size: 1.25rem;
}

body.dark .row-selected {
    background-color: rgba(244, 179, 66, 0.15) !important;
}

/* IMPROVED: Content area with better spacing */
.content {
    box-sizing: border-box;
    overflow-x: hidden;
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Mobile table adjustments */
@media (max-width: 768px) {
    .units-table {
        min-width: 600px;
    }
    .flex-col-mobile {
        flex-direction: column;
    }
    .w-full-mobile {
        width: 100%;
    }
}

/* IMPROVED: Sidebar header with better typography */
.sidebar-header {
    background: var(--sidebar-bg);
    padding: 1.25rem;
    border-bottom: 1px solid var(--muted);
    text-align: left;
}

/* IMPROVED: Enhanced table styling */
.tenant-info {
    display: flex;
    align-items: center;
    gap: 14px;
}

.profile-placeholder {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    background: linear-gradient(135deg, var(--accent), var(--accent-dark));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 1.25rem;
    box-shadow: 0 4px 8px rgba(212,175,55,0.2);
}

.profile-placeholder i {
    font-size: 1.25rem;
}

.tenant-details {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.tenant-name {
    font-weight: 600;
    font-size: 15px;
    color: var(--text);
}

.tenant-contact {
    font-size: 13px;
    color: var(--muted-text);
}

.unit-details {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.unit-number {
    font-weight: 700;
    font-size: 15px;
    color: var(--text);
}

.unit-rent {
    font-size: 13px;
    color: var(--muted-text);
}

/* IMPROVED: Status badges with better affordances */
.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 0.5rem 0.875rem;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.3s ease;
    border: 1px solid transparent;
}

.status-badge i {
    font-size: 12px;
}

.status-active {
    background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(16,185,129,0.08));
    color: #065f46;
    border-color: rgba(16,185,129,0.3);
}

.status-active:hover {
    background: linear-gradient(135deg, rgba(16,185,129,0.25), rgba(16,185,129,0.15));
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16,185,129,0.1);
}

body.dark .status-active {
    background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.08));
    color: #86efac;
    border-color: rgba(34,197,94,0.3);
}

.status-pending {
    background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(245,158,11,0.08));
    color: #92400e;
    border-color: rgba(245,158,11,0.3);
}

.status-pending:hover {
    background: linear-gradient(135deg, rgba(245,158,11,0.25), rgba(245,158,11,0.15));
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(245,158,11,0.1);
}

body.dark .status-pending {
    background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(245,158,11,0.08));
    color: #fcd34d;
    border-color: rgba(245,158,11,0.3);
}

.status-vacant {
    background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.08));
    color: #991b1b;
    border-color: rgba(239,68,68,0.3);
}

.status-vacant:hover {
    background: linear-gradient(135deg, rgba(239,68,68,0.25), rgba(239,68,68,0.15));
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(239,68,68,0.1);
}

body.dark .status-vacant {
    background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.08));
    color: #fca5a5;
    border-color: rgba(239,68,68,0.3);
}

/* IMPROVED: Edit button with better affordances */
.edit-btn {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    border: none;
    color: white;
    font-size: 14px;
    cursor: pointer;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
}

.edit-btn i {
    font-size: 14px;
}

body.dark .edit-btn {
    background: linear-gradient(135deg, #60a5fa, #3b82f6);
}

.edit-btn:hover {
    background: linear-gradient(135deg, #2563eb, #1e40af);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
    color: white;
}

body.dark .edit-btn:hover {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
}

/* IMPROVED: Header with better visual hierarchy */
.header-with-date {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2.5rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.date-display {
    background: var(--surface);
    border-radius: 12px;
    padding: 0.875rem 1.5rem;
    border-left: 4px solid var(--accent);
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    display: flex;
    align-items: center;
    gap: 10px;
}

.date-display i {
    color: var(--accent);
    font-size: 1.25rem;
}

body.dark .date-display {
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

@media (max-width: 768px) {
    .header-with-date {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    .date-display {
        align-self: stretch;
        justify-content: center;
    }
}

/* IMPROVED: Sidebar stats with better spacing */
.sidebar-stats {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1.5rem;
}

/* IMPROVED: Payment Modal Styling */
#paymentModal {
    z-index: 1000;
    animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-card {
    z-index: 1001;
    position: relative;
    animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes modalSlideIn {
    from { transform: translateY(20px) scale(0.95); opacity: 0; }
    to { transform: translateY(0) scale(1); opacity: 1; }
}

body.modal-open {
    overflow: hidden;
}

/* NEW: Fixed height for property form container */
.property-form-container {
    transition: all 0.3s ease;
    height: 500px;
    display: flex;
    flex-direction: column;
}

.property-form-container.hidden {
    display: none;
}

.property-form-container .card-surface {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.property-form-container .card-surface form {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.property-form-container .card-surface form .grid {
    flex: 1;
}

.property-name-display {
    background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(212,175,55,0.08));
    border: 2px solid rgba(212,175,55,0.3);
    border-radius: 14px;
    padding: 1rem 1.25rem; /* Restore original padding */
    margin-bottom: 1.5rem; /* Restore original margin */
    display: flex;
    align-items: center;
    gap: 14px;
    position: relative;
    box-shadow: 0 6px 20px rgba(212,175,55,0.1);
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.property-name-display i {
    color: var(--accent);
    font-size: 1.5rem;
}

body.dark .property-name-display {
    background: linear-gradient(135deg, rgba(244, 179, 66, 0.15), rgba(244, 179, 66, 0.08));
    border: 2px solid rgba(244, 179, 66, 0.3);
    box-shadow: 0 6px 20px rgba(244, 179, 66, 0.1);
}

.property-name-display:hover {
    box-shadow: 0 10px 30px rgba(212,175,55,0.15);
    border-color: rgba(212,175,55,0.5);
    transform: translateY(-3px);
}

body.dark .property-name-display:hover {
    box-shadow: 0 10px 30px rgba(244, 179, 66, 0.15);
    border-color: rgba(244, 179, 66, 0.5);
}

.property-name-text {
    font-size: 1.125rem; /* Restore original size */
    font-weight: 800;
    color: var(--text);
    flex-grow: 1;
    letter-spacing: -0.3px;
}

.property-badge {
    background: var(--accent);
    color: #2b1f00;
    font-size: 11px;
    font-weight: 800;
    padding: 4px 10px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 3px 8px rgba(212,175,55,0.3);
}

body.dark .property-badge {
    color: #1a1400;
    box-shadow: 0 3px 8px rgba(244, 179, 66, 0.3);
}

.full-table-view .lg\:w-2\/3 {
    width: 100% !important;
}

.change-property-btn {
    display: none;
}

.full-table-view .change-property-btn {
    display: block;
    margin: 0 auto 1.5rem auto;
}

.view-table-btn {
    margin-top: 1rem;
}

/* IMPROVED: Modal styling */
#paymentModal .bg-white {
    background: var(--modal-bg) !important;
    color: var(--modal-text);
    border-radius: 20px;
    padding: 2.5rem;
    box-shadow: 0 25px 50px rgba(0,0,0,0.15);
    border: 1px solid var(--muted);
}

#paymentModal .text-gray-700 {
    color: var(--modal-text);
}

#paymentModal input {
    background: var(--surface) !important;
    color: var(--text);
    border: 2px solid var(--muted);
    border-radius: 10px;
    padding: 1rem 1.25rem;
    font-size: 1rem;
    transition: all 0.3s ease;
}

#paymentModal input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 4px rgba(212,175,55,0.15);
    transform: translateY(-2px);
}

body.dark #paymentModal input:focus {
    box-shadow: 0 0 0 4px rgba(244, 179, 66, 0.2);
}

/* IMPROVED: Error/Success messages */
.text-green-600 {
    color: var(--success-text) !important;
}

#paymentErrorDisplay {
    background: var(--error-bg) !important;
    color: var(--error-text) !important;
    border: 2px solid var(--error-text) !important;
    border-radius: 12px;
    padding: 1rem 1.25rem;
    animation: shake 0.5s ease;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

/* IMPROVED: Form elements with better affordances */
select, input {
    background: var(--surface) !important;
    color: var(--text);
    border: 2px solid var(--muted);
    border-radius: 10px;
    padding: 1rem 1.25rem;
    font-size: 1rem;
    transition: all 0.3s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23D4AF37'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1.25rem;
    padding-right: 3rem;
    margin-bottom: 1rem;
}

select::-ms-expand {
    display: none;
}

select:focus, input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 4px rgba(212,175,55,0.15);
    outline: none;
    transform: translateY(-2px);
}

body.dark select:focus, body.dark input:focus {
    box-shadow: 0 0 0 4px rgba(244, 179, 66, 0.2);
}

/* Loading spinner styles */
.loading-spinner {
    display: inline-block;
    width: 1.5rem;
    height: 1.5rem;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
}

.loading-spinner.dark {
    border: 3px solid rgba(0, 0, 0, 0.3);
    border-top-color: #000;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.btn-disabled {
    opacity: 0.7;
    cursor: not-allowed !important;
    pointer-events: none;
}

/* IMPROVED: Loading overlay */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    backdrop-filter: blur(5px);
}

.loading-overlay.active {
    opacity: 1;
    visibility: visible;
}

.loading-overlay-content {
    background: var(--surface);
    padding: 2.5rem;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    border: 2px solid var(--accent);
    max-width: 400px;
    width: 90%;
    animation: pulse 2s infinite;
}

.overlay-spinner {
    width: 4rem;
    height: 4rem;
    border: 4px solid rgba(212, 175, 55, 0.2);
    border-radius: 50%;
    border-top-color: var(--accent);
    animation: spin 1s linear infinite;
    margin: 0 auto 1.5rem;
}

body.dark .overlay-spinner {
    border: 4px solid rgba(244, 179, 66, 0.2);
    border-top-color: var(--accent);
}

/* IMPROVED: Property form loading button */
#propertyFormSubmit.btn-loading {
    position: relative;
    overflow: hidden;
}

#propertyFormSubmit.btn-loading::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: loadingShimmer 1.5s infinite;
}

@keyframes loadingShimmer {
    to { left: 100%; }
}

#propertyFormSubmit.btn-loading .btn-text {
    visibility: hidden;
}

#propertyFormSubmit.btn-loading .loading-spinner {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
}

/* IMPROVED: Quick actions toolbar */
.quick-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.quick-action-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 0.875rem 1.5rem;
    background: var(--surface);
    border: 2px solid var(--muted);
    border-radius: 12px;
    color: var(--text);
    font-weight: 600;
    font-size: 0.95rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    text-decoration: none;
}

.quick-action-btn i {
    color: var(--accent);
    font-size: 1.125rem;
    transition: transform 0.3s ease;
}

.quick-action-btn:hover {
    background: var(--accent);
    color: #2b1f00;
    border-color: var(--accent);
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(212,175,55,0.2);
}

.quick-action-btn:hover i {
    color: #2b1f00;
    transform: scale(1.1);
}

body.dark .quick-action-btn:hover {
    color: #1a1400;
}

/* IMPROVED: Toast notifications */
.toast {
    position: fixed;
    top: 5rem;
    right: 30px;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    color: white;
    font-weight: 600;
    z-index: 10000;
    animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s;
    animation-fill-mode: forwards;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    max-width: 350px;
}

@keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes fadeOut {
    to { opacity: 0; transform: translateX(100%); }
}

.toast-success {
    background: linear-gradient(135deg, #10b981, #059669);
    border-left: 4px solid #047857;
}

.toast-error {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-left: 4px solid #b91c1c;
}

.toast-warning {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    border-left: 4px solid #b45309;
}

.toast i {
    font-size: 1.25rem;
}

/* Mobile responsiveness improvements */
@media (max-width: 768px) {
    .content {
        padding: 1.5rem;
    }

    .header-with-date h1 {
        font-size: 1.5rem;
    }

    .header-with-date p {
        font-size: 0.95rem;
    }

    .date-display {
        padding: 0.75rem 1.25rem;
        font-size: 0.95rem;
        width: 100%;
        justify-content: space-between;
    }

    .card-surface {
        padding: 1.5rem;
    }

    .main-wrap {
        min-height: calc(100vh - 64px);
    }

    .sidebar {
        height: calc(100vh - 64px);
        top: 64px;
    }

    .toast {
        top: 5rem;
        right: 15px;
        left: 15px;
        max-width: none;
    }
}

@media (max-width: 640px) {
    .property-name-text {
        font-size: 1rem;
    }

    .header-actions {
        gap: 0.75rem;
    }

    .theme-toggle,
    #mobile-menu-button {
        width: 40px;
        height: 40px;
    }
}

/* Small mobile adjustments */
@media (max-width: 480px) {
    .revenue-stats-container {
        gap: 1rem;
    }

    .header-actions {
        gap: 0.625rem;
    }

    .theme-toggle,
    #mobile-menu-button {
        width: 38px;
        height: 38px;
    }

    .search-input {
        padding: 0.875rem 1rem 0.875rem 3rem;
        font-size: 0.95rem;
    }
}

/* IMPROVED: Empty states */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--muted-text);
}

.empty-state-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    opacity: 0.3;
    color: var(--accent);
}

.empty-state-title {
    font-size: 1.5rem;
    margin-bottom: 0.75rem;
    color: var(--text);
    font-weight: 700;
}

.empty-state-description {
    font-size: 1rem;
    margin-bottom: 2rem;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.6;
}

.empty-state-action {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 0.875rem 1.75rem;
    background: var(--accent);
    color: #2b1f00;
    border-radius: 12px;
    font-weight: 700;
    text-decoration: none;
    transition: all 0.3s ease;
}

.empty-state-action:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(212,175,55,0.3);
}

/* IMPROVED: Filter chips */
.filter-chips {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.filter-chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 0.5rem 1rem;
    background: var(--surface);
    border: 1px solid var(--muted);
    border-radius: 20px;
    font-size: 0.875rem;
    color: var(--text);
    cursor: pointer;
    transition: all 0.3s ease;
}

.brand-text {
    font-weight: 900;
    font-size: 32px !important;
    letter-spacing: 1.5px;
    color: var(--accent);
    background: linear-gradient(90deg, var(--accent), var(--accent-dark));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 2px;
}

.filter-chip i {
    font-size: 0.75rem;
    opacity: 0.7;
}

.filter-chip:hover {
    background: var(--muted);
    transform: translateY(-2px);
}

.filter-chip.active {
    background: var(--accent);
    color: #2b1f00;
    border-color: var(--accent);
    font-weight: 600;
}

.filter-chip.active i {
    color: #2b1f00;
    opacity: 1;
}

/* NEW: Table pagination styles */
.table-pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-top: 1.5rem;
    padding: 1rem;
    background: var(--surface);
    border-radius: 12px;
    border: 1px solid var(--muted);
}

.page-info {
    font-size: 0.875rem;
    color: var(--muted-text);
}

.pagination-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--surface);
    border: 1px solid var(--muted);
    border-radius: 8px;
    color: var(--text);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.pagination-btn:hover:not(:disabled) {
    background: var(--accent);
    color: #2b1f00;
    border-color: var(--accent);
    transform: translateY(-2px);
}

.pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* NEW: Search filter styles */
.table-search-filters {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.search-filter {
    flex: 1;
    min-width: 200px;
    position: relative;
}

.search-filter input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.5rem;
    background: var(--surface);
    border: 1px solid var(--muted);
    border-radius: 8px;
    color: var(--text);
    font-size: 0.875rem;
}

.search-filter i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted-text);
    font-size: 0.875rem;
}

.clear-search-btn {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--muted-text);
    cursor: pointer;
    padding: 0.25rem;
}

.clear-search-btn:hover {
    color: var(--accent);
}

/* Quick navigation buttons for compact sidebar */
.quick-nav-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.nav-btn {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: rgba(212,175,55,0.1);
    border: 1px solid rgba(212,175,55,0.2);
    border-radius: 10px;
    color: var(--text);
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.nav-btn i {
    color: var(--accent);
    font-size: 1rem;
}

.nav-btn:hover {
    background: rgba(212,175,55,0.15);
    border-color: var(--accent);
    transform: translateX(4px);
}

body.dark .nav-btn {
    background: rgba(244, 179, 66, 0.1);
    border-color: rgba(244, 179, 66, 0.2);
}

body.dark .nav-btn:hover {
    background: rgba(244, 179, 66, 0.15);
}

/* Make property name display more compact */
.property-name-display {
    background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(212,175,55,0.08));
    border: 2px solid rgba(212,175,55,0.3);
    border-radius: 12px;
    padding: 0.75rem 1rem;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 10px;
    position: relative;
    box-shadow: 0 4px 12px rgba(212,175,55,0.1);
    transition: all 0.3s ease;
}

.property-name-text {
    font-size: 1rem;
    font-weight: 700;
    color: var(--text);
    flex-grow: 1;
    letter-spacing: -0.2px;
}

/* Adjust stats text sizes */
.sidebar .card p.text-sm {
    font-size: 0.8125rem;
}

.sidebar .card p.text-lg {
    font-size: 1.125rem;
}

/* Mobile adjustments */
@media (max-width: 768px) {
    .sidebar-content {
        padding: 0.75rem;
        gap: 0.5rem;
    }

    .property-name-display {
        padding: 0.625rem 0.875rem;
        margin-bottom: 0.5rem;
    }

    .property-name-text {
        font-size: 0.9375rem;
    }

    .nav-btn {
        padding: 0.625rem 0.875rem;
        font-size: 0.8125rem;
    }

    .feature-icon {
        width: 38px;
        height: 38px;
        font-size: 1rem;
    }
}

/* Highlighted payment column */
.units-table th:nth-child(6),
.units-table td:nth-child(6) {
    background: rgba(212,175,55,0.1) !important;
    position: relative;
}

.units-table th:nth-child(6)::before,
.units-table td:nth-child(6)::before {
    content: 'ðŸ’°';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    opacity: 0.3;
    font-size: 1.5rem;
}

body.dark .units-table th:nth-child(6),
body.dark .units-table td:nth-child(6) {
    background: rgba(244,179,66,0.15) !important;
}

.units-table th:nth-child(6)::after,
.units-table td:nth-child(6)::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: 4px;
    background: var(--accent);
    opacity: 0.6;
}

.units-table td:nth-child(6):hover {
    background: rgba(212,175,55,0.2) !important;
}

body.dark .units-table td:nth-child(6):hover {
    background: rgba(244,179,66,0.25) !important;
}

.payment-cell {
    cursor: pointer;
    transition: all 0.2s ease;
}

.payment-cell:hover .indicator {
    transform: scale(1.1);
}

@media (max-width: 640px) {
    .payment-cell .indicator {
        width: 2.5rem;
        height: 2.5rem;
        font-size: 1.25rem;
    }
}

/* Quick Guide styling */
.quick-guide {
    background: linear-gradient(135deg, rgba(212, 175, 55, 0.05) 0%, rgba(212, 175, 55, 0.02) 100%);
    border-radius: 0.75rem;
    padding: 1rem;
    margin: 1rem 0;
    border: 1px solid rgba(212, 175, 55, 0.1);
}

body.dark .quick-guide {
    background: linear-gradient(135deg, rgba(244, 179, 66, 0.08) 0%, rgba(244, 179, 66, 0.03) 100%);
    border: 1px solid rgba(244, 179, 66, 0.15);
}

.guide-item {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.guide-item:last-child {
    margin-bottom: 0;
}

.guide-check {
    color: var(--accent);
    font-weight: bold;
    flex-shrink: 0;
    margin-top: 0.125rem;
}

/* Field tooltip */
.field-tooltip {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--accent);
    color: #2b1f00;
    font-size: 10px;
    font-weight: bold;
    cursor: help;
    margin-left: 0.25rem;
    vertical-align: middle;
}

body.dark .field-tooltip {
    color: #1a1400;
}

/* Hero surface for cards */
.hero-surface {
    background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(250,250,250,0.9));
    box-shadow: 0 6px 20px rgba(31,41,55,0.06);
}

body.dark .hero-surface {
    background: linear-gradient(180deg, rgba(30, 41, 59, 0.6), rgba(15, 23, 42, 0.9));
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

/* Card highlight */
.card-highlight {
    border-top-width: 4px;
    border-top-style: solid;
    border-color: rgba(212,175,55,0.26);
}

body.dark .card-highlight {
    border-color: rgba(244, 179, 66, 0.26);
}

/* Progress dot */
.progress-dot {
    width: 12px;
    height: 12px;
    border-radius: 9999px;
    display: inline-block;
}

/* Input focus states */
.input-focus:focus {
    outline: none;
    box-shadow: 0 0 0 4px rgba(212,175,55,0.08);
    border-color: var(--accent);
}

body.dark .input-focus:focus {
    box-shadow: 0 0 0 4px rgba(244, 179, 66, 0.15);
}

/* Form specific styles */
.form-card {
    background: var(--surface);
    padding: 1.5rem;
    border-radius: 1rem;
    box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1);
    border: 1px solid var(--muted);
    width: 100%;
    transition: all 0.3s ease;
}

body.dark .form-card {
    box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3), 0 8px 10px -6px rgba(0,0,0,0.2);
}

/* Form details */
.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 24px;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
        gap: 16px;
    }
}

.form-field {
    display: flex;
    flex-direction: column;
}

.form-section {
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--muted);
}

.form-section:last-of-type {
    border-bottom: none;
    margin-bottom: 1rem;
}

.form-section h3 {
    font-size: 18px;
    margin-bottom: 16px;
    padding-bottom: 8px;
    color: var(--text);
    border-bottom: 2px solid var(--text);
    font-weight: 700;
}

/* Error handling */
.error-message {
    color: var(--error);
    font-size: 0.875rem;
    margin-top: 0.25rem;
    display: none;
}
.error-message.show {
    display: block;
}

/* Helper text */
.helper-text {
    font-size: 0.875rem;
    color: var(--muted-text);
    margin-top: 4px;
    min-height: 18px;
}

/* Form title */
.form-title {
    font-size: 24px;
    margin-bottom: 1.5rem;
    text-align: center;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--text);
    color: var(--text);
    font-weight: 800;
}

/* Action buttons */
.form-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 1.5rem;
}

.full-width {
    grid-column: 1 / -1;
}

/* Stepper */
.stepper {
    padding: 0.75rem 0;
    font-size: 14px;
    background: var(--surface);
    border-bottom: 1px solid var(--muted);
    transition: all 0.3s ease;
}
.stepper .progress-dot {
    width: 10px;
    height: 10px;
}

/* Main content area */
main {
    padding: 1.5rem 0;
    background: var(--bg);
    transition: background-color 0.3s ease;
}

/* Footer */
footer {
    padding: 2rem 0;
    margin-top: 2rem;
    font-size: 0.875rem;
    background: var(--surface);
    border-top: 1px solid var(--muted);
    transition: all 0.3s ease;
}

/* Welcome card */
.welcome-card {
    background: var(--surface);
    padding: 1.5rem;
    border-radius: 1rem;
    box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1);
    border: 1px solid var(--muted);
    width: 100%;
    transition: all 0.3s ease;
}

body.dark .welcome-card {
    box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3), 0 8px 10px -6px rgba(0,0,0,0.2);
}

/* Two-column layout */
@media (max-width: 1023px) {
    .main-content {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .welcome-card.collapsible {
        cursor: pointer;
    }

    .welcome-card .collapse-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
    }

    .welcome-card.expanded .collapse-content {
        max-height: 500px;
    }

    .mobile-toggle-icon {
        transition: transform 0.3s ease;
    }

    .welcome-card.expanded .mobile-toggle-icon {
        transform: rotate(180deg);
    }
}

@media (min-width: 1024px) {
    .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        align-items: start;
    }
}

/* Info highlight */
.info-highlight {
    background-color: rgba(59, 130, 246, 0.1);
    padding: 0.75rem;
    border-radius: 0.5rem;
    border-left: 4px solid var(--accent);
    margin: 0.5rem 0;
}

body.dark .info-highlight {
    background-color: rgba(59, 130, 246, 0.15);
}

/* Graph icon */
.graph-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.5rem;
    height: 1.5rem;
}

.graph-icon svg {
    width: 100%;
    height: 100%;
}

/* Required star */
.required-star {
    color: var(--error);
    margin-left: 0.15rem;
}

/* Brand text fix */
header .text-lg.font-extrabold.text-accent {
    font-size: 1.25rem;
    font-weight: 800;
}

header .text-xs.text-muted {
    font-size: 0.75rem;
    color: var(--muted-text);
    margin-top: -0.25rem;
}

/* Fix for desktop layout */
@media (min-width: 1025px) {
    .content {
        margin-left: 260px;
        padding: 2.5rem;
        width: calc(100% - 260px);
        min-height: calc(100vh - 64px);
        box-sizing: border-box;
        overflow-y: auto;
    }

    .sidebar {
        height: calc(100vh - 64px);
        top: 64px;
        left: 0;
    }
}

/* Fix z-index issues */
header {
    z-index: 50;
}

.sidebar {
    z-index: 40;
}

#mobile-menu {
    z-index: 45;
}

#sidebar-backdrop {
    z-index: 35;
}

/* NEW: Added spacing between image and "Add New Property" button */
.logo-container {
    margin-bottom: 1.5rem; /* Add space below the logo */
}

/* NEW: Added spacing between table and "Create New Unit" button */
.table-section {
    margin-bottom: 1.5rem; /* Add space below the table */
}
    </style>
</head>

<body class="antialiased" th:classappend="${user_chosen_theme == 'dark'} ? 'dark' : ''">
<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-overlay-content">
        <div class="overlay-spinner"></div>
        <p class="text-lg font-semibold text-[var(--text)]">Loading Property...</p>
        <p class="text-sm text-[var(--muted-text)] mt-2">Please wait while we fetch your property data</p>
    </div>
</div>

<!-- Toast Notification Container -->
<div id="toastContainer"></div>

<!-- Store Thymeleaf variable in JavaScript -->
<script th:inline="javascript">
    /*<![CDATA[*/
    const serverTheme = /*[[${user_chosen_theme}]]*/ 'light';
    console.log("Server theme from Thymeleaf:", serverTheme);
    /*]]>*/
</script>
<header class="bg-surface shadow-lg sticky top-0 z-30 transition-colors duration-300">
    <div class="max-w-6xl px-6 py-3 flex items-center justify-between mx-auto">
        <div class="flex items-center gap-3">
            <div class="flex flex-col">
                <div class="brand-header">
                    <h1 class="brand-text">PROMAN</h1>
                </div>
                <div class="text-xs text-muted -mt-1">Property management simplified</div>
            </div>
        </div>

        <!-- Header Actions -->
        <div class="header-actions flex items-center gap-3">
            <!-- Dark Mode Toggle -->
            <button id="dark-mode-toggle" class="theme-toggle flex items-center justify-center w-12 h-12 rounded-lg bg-muted text-text border border-muted transition-all duration-200 hover:bg-accent hover:text-[#2b1f00] hover:border-accent"
                    aria-label="Toggle dark mode" title="Toggle theme">
                <i class="fas fa-moon text-lg" id="moon-icon"></i>
                <i class="fas fa-sun text-lg hidden" id="sun-icon"></i>
            </button>

            <!-- Desktop Navigation Links -->
            <nav id="nav-links" class="hidden lg:flex items-center gap-3 text-sm font-medium">
                <a href="http://localhost:7070/"
                   class="login-btn border-2 px-4 py-1.5 rounded-lg font-semibold shadow-sm transition-all duration-200 border-muted bg-surface text-text hover:bg-muted">
                    Home
                </a>
                <a href="http://localhost:7070/dashboard"
                   class="login-btn border-2 px-4 py-1.5 rounded-lg font-semibold shadow-sm transition-all duration-200 border-muted bg-surface text-text hover:bg-muted">
                    Dashboard
                </a>
                <a href="http://localhost:7070/log_out"
                   class="signup-btn px-5 py-1.5 rounded-lg font-semibold shadow-lg transition-all duration-200 transform hover:-translate-y-0.5 bg-accent text-[#2b1f00] hover:bg-accent-dark hover:text-white">
                    Log out
                </a>
            </nav>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="flex lg:hidden items-center justify-center w-12 h-12 rounded-lg bg-surface text-text border border-muted transition-all duration-200 hover:bg-muted"
                    aria-label="Open navigation menu" aria-expanded="false" aria-controls="mobile-menu" title="Open menu">
                <div class="mobile-menu-icon flex flex-col gap-1 w-5">
                    <span class="block h-0.5 w-full bg-text rounded transition-all duration-300"></span>
                    <span class="block h-0.5 w-full bg-text rounded transition-all duration-300"></span>
                    <span class="block h-0.5 w-full bg-text rounded transition-all duration-300"></span>
                </div>
            </button>
        </div>
    </div>

    <!-- Mobile menu (hidden by default) -->
    <div id="mobile-menu" class="lg:hidden hidden px-6 pb-3 space-y-2 bg-surface border-t border-muted">
        <a href="http://localhost:7070/"
           class="block w-full text-center login-btn border-2 px-4 py-1.5 rounded-lg font-semibold shadow-sm transition-all duration-200 border-muted bg-surface text-text hover:bg-muted">
            HOME
        </a>
        <a href="http://localhost:7070/dashboard"
           class="block w-full text-center login-btn border-2 px-4 py-1.5 rounded-lg font-semibold shadow-sm transition-all duration-200 border-muted bg-surface text-text hover:bg-muted">
            DASHBOARD
        </a>
        <a href="http://localhost:7070/log_out"
           class="block w-full text-center signup-btn px-5 py-1.5 rounded-lg font-semibold shadow-lg transition-all duration-200 transform hover:-translate-y-0.5 bg-accent text-[#2b1f00] hover:bg-accent-dark hover:text-white">
            LOG OUT
        </a>
    </div>
</header>

<div id="sidebar-backdrop"></div>
<div class="main-wrap">
    <aside id="sidebar" class="sidebar" role="navigation" aria-label="Main sidebar">
        <div class="sidebar-content">
            <!-- Property name with reduced margin -->
            <div class="property-name-display" style="margin-bottom: 0.5rem;">
                <i class="fas fa-building"></i>
                <span class="property-name-text" th:text="${name}">Property Name</span>
            </div>

            <!-- Quick navigation buttons with reduced spacing -->
<!--            <div class="quick-nav-buttons mb-2">-->
<!--                <a href="http://localhost:7070/add_tenant" class="nav-btn">-->
<!--                    <i class="fas fa-user-plus"></i>-->
<!--                    <span>ADD NEW TENANT</span>-->
<!--                </a>-->
<!--            </div>-->
            <div class="quick-nav-buttons mb-2"> <!-- Added margin-top for spacing -->
                <a data-tooltip="add new unit"  href="http://localhost:7070/create_new_unit" class="nav-btn">
                    <i class="fas fa-plus"></i>
                    Create New Unit
                </a>
            </div>

            <!-- Sidebar stats with minimal spacing -->
            <div class="sidebar-stats" style="margin-top: 0.5rem;">
                <div class="card rounded-lg p-3">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm" style="color:var(--muted-text)">Property Owner</p>
                            <p class="text-lg font-bold" style="color:var(--text)" th:text="${user_name}">8</p>
                        </div>
                        <div class="feature-icon">
                            <i class="fas fa-home"></i>
                        </div>
                    </div>
                </div>

                <div class="card rounded-lg p-3" style="border-left-color: rgba(34,197,94,0.18);">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm" style="color:var(--muted-text)">Occupied Units</p>
                            <p class="text-lg font-bold" style="color:var(--text)" th:text="${occupied_units}">0</p>
                        </div>
                        <div class="feature-icon" style="background: rgba(255,255,255,0.06); color:var(--text)">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <p class="text-sm"
                       style="color:var(--muted-text); margin-top:6px"
                       th:text="${occupancyRate + '% occupancy rate'}">
                        0% occupancy rate
                    </p>
                </div>

                <div class="card rounded-lg p-3" style="border-left-color: rgba(59,130,246,0.18);">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm" style="color:var(--muted-text)">Vacant Units</p>
                            <p class="text-lg font-bold" style="color:var(--text)"  th:text="${vacant}">2</p>
                        </div>
                        <div class="feature-icon" style="background: rgba(255,255,255,0.06); color:var(--text)">
                            <i class="fas fa-bed"></i>
                        </div>
                    </div>
                    <p class="text-sm" style="color:var(--muted-text); margin-top:6px">Available for rent</p>
                </div>

                <div class="card rounded-lg p-3" style="border-left-color: rgba(139,92,60,0.18);">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm" style="color:var(--muted-text)">Monthly Revenue</p>
                            <p class="text-lg font-bold" style="color:var(--text)" th:text="'R' + ${expected_profit}">R0</p>
                        </div>
                        <div class="feature-icon" style="background: rgba(255,255,255,0.06); color:var(--text)">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
<!--                    <p class="text-sm" style="color:var(&#45;&#45;muted-text); margin-top:6px">+R2,500 from last month</p>-->
                </div>
            </div>

            <div class="mt-auto pt-6">
                <a href="http://localhost:7070/logout"
                   class="w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg bg-gradient-to-r from-yellow-500 to-yellow-600 text-white font-bold shadow-lg hover:from-yellow-600 hover:to-yellow-700 transition-all duration-200 transform hover:scale-[1.02] active:scale-95">
                    <i class="fas fa-sign-out-alt"></i>
                    Sign Out
                </a>
            </div>
        </div>
    </aside>
    <main class="content">
        <div class="p-4 md:p-6">
            <!-- Updated header with date display on the right -->
            <div class="header-with-date">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold" style="color:var(--accent)">Property Management</h1>
                </div>

                <!-- Date display div with gold right border -->
                <div class="date-display">
                    <i class="fas fa-calendar-alt"></i>
                    <span class="text-base md:text-lg font-medium" id="currentDate"></span>
                </div>
            </div>

            <!-- Quick Actions Toolbar -->


            <!-- Filter Chips -->
            <div class="filter-chips">
                <div class="filter-chip active" onclick="filterTable('all')">
                    <i class="fas fa-layer-group"></i>
                    All Tenants
                </div>
                <div class="filter-chip" onclick="filterTable('paid')">
                    <i class="fas fa-check-circle"></i>
                    Paid
                </div>
                <div class="filter-chip" onclick="filterTable('unpaid')">
                    <i class="fas fa-times-circle"></i>
                    Unpaid
                </div>
            </div>

            <div class="flex flex-col lg:flex-row gap-4 md:gap-6" id="mainContent">
                <!-- Property Selection Section - Now with fixed height -->
                <div class="lg:w-1/3 property-form-container" id="propertyFormContainer">
                    <div class="card-surface h-full">
                        <form id="propertyForm" action="http://localhost:7070/fetch_property_units" method="post">
                            <div class="grid grid-cols-1 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-[var(--muted-text)] mb-2">
                                        <i class="fas fa-building mr-2"></i>
                                        Property Name
                                    </label>
                                    <p class="font-semibold text-lg mb-3" th:text="${name}"></p>
                                    <select id="propertySelect" name="name" class="w-full rounded-md border-gray-300 shadow-sm focus:ring-0 focus:border-[var(--accent)]">
                                        <option value="">Select property</option>
                                        <option th:each="name : ${names}" th:value="${name}" th:text="${name}">Default Name</option>
                                    </select>
                                </div>
                            </div>
                            <!-- Submit button with loading spinner -->
                            <div class="mt-2">
                                <button type="submit" id="propertyFormSubmit" class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-[var(--accent)] text-[var(--text)] rounded-lg hover:bg-[var(--accent-dark)] transition font-medium shadow-lg">
                                    <i class="fas fa-sync-alt" id="propertySubmitIcon"></i>
                                    <span id="propertySubmitText" class="btn-text">myproman</span>
                                    <div id="propertySubmitSpinner" class="loading-spinner hidden"></div>
                                </button>
                            </div>
                        </form>

                        <div class="mt-4 logo-container">
                            <div class="border border-gray-300 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center h-48">
                                <img src="/umuzi/img/mypromann.png" alt="ProMan logo"
                                     class="h-28 md:h-32 lg:h-36 w-auto object-contain">
                            </div>
                        </div>
                        <!-- Moved "Add New Property" button below the logo with spacing -->
                        <div class="quick-nav-buttons mb-2"> <!-- Added margin-top for spacing -->
                            <a href="http://localhost:7070/add_property_unit" class="quick-action-btn w-full justify-center">
                                <i class="fas fa-plus"></i>
                                Add New Property
                            </a>
                        </div>
                    </div>
                </div>


                <!-- Table Section -->
                <div class="lg:w-2/3" id="tableContainer">

                    <div class="card-surface h-full">
                        <!-- View Units Table button -->
                        <button id="viewTableBtn" class="change-property-btn w-full inline-flex items-center justify-center gap-2 px-4 py-2 bg-[var(--accent)] text-[var(--text)] rounded-lg hover:bg-[var(--accent-dark)] transition font-medium mb-4">
                            <i class="fas fa-table"></i>
                            View Units Table
                        </button>

                        <!-- NEW: Search Filters -->
                        <div class="table-search-filters mb-4">
                            <div class="search-filter">
                                <i class="fas fa-search"></i>
                                <input type="text" id="tenantSearch" placeholder="Search by tenant name..."
                                       class="w-full px-4 py-2 pl-10 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--accent)]">
                                <button class="clear-search-btn" onclick="clearSearch('tenantSearch')">

                                </button>
                            </div>
                            <div class="search-filter">
                                <i class="fas fa-home"></i>
                                <input type="text" id="unitSearch" placeholder="Search by unit number..."
                                       class="w-full px-4 py-2 pl-10 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--accent)]">
                                <button class="clear-search-btn" onclick="clearSearch('unitSearch')">

                                </button>
                            </div>
                        </div>

                        <div id="controlsWrapper" class="mb-4 flex flex-wrap gap-3 items-center">
                            <div class="text-sm" style="color:var(--text)">
                                <i class="fas fa-mouse-pointer mr-2"></i>
                                Click the payment column to mark a tenant as paid.
                            </div>
                        </div>

                        <div id="paymentErrorDisplay" class="hidden p-3 mb-4 rounded-md text-sm font-medium bg-red-100 text-red-800 border border-red-300" role="alert">
                        </div>
                        <p th:if="${unit != null and unit != ''}"
                           th:text="|You have already marked Unit ${unit} as paid this month.|" class="text-green-600 font-medium text-sm md:text-base"></p>
                        <p th:if="${success != null and success != ''}"
                           th:text="|Unit ${success} marked as paid this month.|" class="text-green-600 font-medium text-sm md:text-base"></p>

                        <!-- No Results Message -->
                        <div id="noResultsMessage" class="hidden p-4 mb-4 rounded-md text-sm font-medium bg-gray-100 text-gray-800 border border-gray-300 text-center">
                            <i class="fas fa-search mr-2"></i>
                            No tenants found matching your criteria
                        </div>

                        <div class="units-wrapper table-section"> <!-- Added table-section class -->
                            <table class="units-table min-w-max w-full border-collapse">
                                <thead>
                                <tr>
                                    <th class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap text-sm md:text-base">
                                        <i class="fas fa-user mr-2"></i>
                                        Tenant
                                    </th>
                                    <th class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap text-sm md:text-base">
                                        <i class="fas fa-home mr-2"></i>
                                        Unit
                                    </th>
                                    <th class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap text-sm md:text-base">
                                        <i class="fas fa-circle mr-2"></i>
                                        Status
                                    </th>
                                    <th class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap text-sm md:text-base">
                                        <i class="fas fa-calendar-day mr-2"></i>
                                        Rent Day
                                    </th>
                                    <th class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap text-sm md:text-base">
                                        <i class="fas fa-clock mr-2"></i>
                                        Overdue
                                    </th>
                                    <th class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap text-sm md:text-base">
                                        Payment
                                    </th>
                                    <th class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap text-sm md:text-base">
                                        <i class="fas fa-cog mr-2"></i>
                                        Actions
                                    </th>
                                </tr>
                                </thead>
                                <tbody id="unitsTbody">
                                <!-- Show units when they exist -->
                                <tr th:each="entry : ${units}" class="hover:cursor-pointer tenant-row">
                                    <td class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap">
                                        <div class="tenant-info">
                                            <div class="profile-placeholder">
                                                <i class="fas fa-user"></i>
                                            </div>
                                            <div class="tenant-details">
                                                <div class="tenant-name text-sm md:text-base" th:text="${entry.value[3]}">Tenant </div>
                                                <div class="tenant-contact status-badge text-xs"
                                                     th:with="debtAmount=${entry.value[7]} ?: 0"
                                                     th:classappend="${debtAmount &gt; 0} ? 'status-vacant' : 'status-active'"
                                                     th:data-tenant-contact="${entry.value[8]}"
                                                     th:text="${debtAmount &gt; 0} ? 'Debt: R' + ${debtAmount} : 'No Debt'">
                                                    <i class="fas fa-phone mr-1"></i>
                                                    Contact info
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap unit-number-cell text-sm md:text-base" th:text="${entry.value[0]}">Unit </td>
                                    <td class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap">
                                        <span th:if="${entry.value[2]} == 'yes'" class="status-badge status-active text-xs">
                                            <i class="fas fa-check-circle mr-1"></i>
                                            Occupied
                                        </span>
                                        <span th:if="${entry.value[2]} == 'no'" class="status-badge status-vacant text-xs">
                                            <i class="fas fa-times-circle mr-1"></i>
                                            Vacant
                                        </span>
                                    </td>
                                    <td class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap unit-tenant text-sm md:text-base" th:text="${entry.value[4]}">Rent Day</td>
                                    <td class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap unit-tenant text-sm md:text-base" th:text="${entry.value[5]}">Overdue Days</td>
                                    <td class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap payment-cell">
    <span th:if="${entry.value[2]} == 'yes'"
          th:with="isPaid=${entry.value[6]}"
          th:classappend="${isPaid} ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
          class="indicator open-pay cursor-pointer text-sm md:text-base"
          th:data-unit="${entry.value[0]}"
          th:data-rent="${entry.value[1]}"
          th:data-id="${entry.value[3]}"
          th:data-property-name="${propertyName}"
          th:data-tenant-contact="${entry.value[8]}"
          th:text="${isPaid} ? 'âœ“' : 'âœ—'">âœ—</span>
                                        <span th:if="${entry.value[2]} == 'no'" class="indicator bg-red-100 text-red-800 text-sm md:text-base">

                                        </span>
                                    </td>
                                    <td class="px-3 py-2 md:px-4 md:py-3 whitespace-nowrap">
                                        <a th:href="@{/tenant_profile/{id}/{unit}/{propertyRent}/{contact}(id=${entry.value[3]},unit=${entry.value[0]},propertyRent=${entry.value[1]},
                                        contact=${entry.value[8]})}" class="edit-btn">
                                            <i class="fas fa-edit"></i>
                                            Edit
                                        </a>
                                    </td>
                                </tr>

                                <!-- Show "No Units" message when empty -->
                                <tr th:if="${units == null or units.isEmpty()}" class="no-units-row">
                                    <td colspan="7" class="px-4 py-8">
                                        <div class="empty-state">
                                            <div class="empty-state-icon">
                                                <i class="fas fa-home"></i>
                                            </div>
                                            <h3 class="empty-state-title">No Units Found</h3>
                                            <p class="empty-state-description">
                                                You don't have any units added yet. Get started by adding your first unit and tenant to begin managing your property.
                                            </p>
                                            <a href="http://localhost:7070/add_tenant" class="empty-state-action">
                                                <i class="fas fa-plus"></i>
                                                Add New Unit
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- Moved "Create New Unit" button below the table with spacing -->
<!--                        <div class="mt-6"> &lt;!&ndash; Added margin-top for spacing &ndash;&gt;-->
<!--                            <a data-tooltip="add new unit" href="http://localhost:7070/create_new_unit" class="quick-action-btn w-full justify-center">-->
<!--                                <i class="fas fa-plus"></i>-->
<!--                                Create New Unit-->
<!--                            </a>-->
<!--                        </div>-->

                        <div class="quick-nav-buttons mb-2">
                            <a href="http://localhost:7070/add_tenant" class="nav-btn">
                                <i class="fas fa-user-plus"></i>
                                <span>ADD NEW TENANT</span>
                            </a>
                        </div>
                        <!-- NEW: Pagination Controls -->
                        <div class="table-pagination hidden" id="paginationControls">
                            <button class="pagination-btn" id="prevPageBtn" disabled onclick="changePage(-1)">
                                <i class="fas fa-chevron-left"></i>
                                Previous
                            </button>
                            <div class="page-info" id="pageInfo">Page 1 of 1</div>
                            <button class="pagination-btn" id="nextPageBtn" disabled onclick="changePage(1)">
                                Next
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<p th:text="${default_name}"></p>

<div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-[1000]">
    <div class="modal-card w-11/12 md:w-96 text-center z-[1001]">
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-lg font-semibold mb-3 flex items-center justify-center gap-2">
                <i class="fas fa-money-check-alt text-green-600"></i>
                Update Payment Status
            </h2>
            <p class="text-gray-700 mb-2">
                <i class="fas fa-home mr-2"></i>
                Unit: <span id="modalUnitDisplay" class="font-bold"></span>
            </p>
            <p class="text-gray-700 mb-4 text-sm">
                <i class="fas fa-dollar-sign mr-2"></i>
                Original Rent: <span id="modalOriginalRent" class="font-bold"></span>
            </p>
            <form id="paymentForm" method="post">
                <input type="hidden" name="action_type" id="modalAction">
                <input type="hidden" name="unit" id="modalUnit">
                <input type="hidden" name="id" id="modalId">
                <input type="hidden" name="property_name" id="modalPropertyName">
                <input type="hidden" name="tenant_contact" id="modalTenantContact">
                <input type="hidden" name="paid" value="yes">
                <div class="mb-4 text-left">
                    <label for="modalRentInput" class="block text-sm font-medium text-[var(--muted-text)] mb-2 flex items-center gap-2">
                        <i class="fas fa-money-bill-wave"></i>
                        Rent Paid Amount:
                    </label>
                    <input type="number" id="modalRentInput" name="rent" step="1" min="0"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--accent)] focus:border-transparent"
                           placeholder="Enter rent amount">
                </div>
                <div class="flex gap-3 flex-col sm:flex-row">
                    <button type="submit" id="modalSubmitBtn" class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium transition">
                        <i class="fas fa-check-circle"></i>
                        <span class="btn-text">Confirm Payment</span>
                        <div id="modalSubmitSpinner" class="loading-spinner hidden"></div>
                    </button>
                    <button type="button" onclick="closePaymentModal()" class="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-medium transition flex items-center justify-center gap-2">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // =========================================================================
    // NEW: Table Pagination and Search Functionality
    // =========================================================================

    let currentPage = 1;
    const itemsPerPage = 10;
    let allRows = [];
    let filteredRows = [];

    function initializeTablePagination() {
        allRows = Array.from(document.querySelectorAll('.tenant-row'));
        filteredRows = [...allRows];

        // Show all rows initially
        allRows.forEach(row => row.classList.remove('hidden'));

        // Setup search filters
        const tenantSearch = document.getElementById('tenantSearch');
        const unitSearch = document.getElementById('unitSearch');

        if (tenantSearch) {
            tenantSearch.addEventListener('input', () => applyFilters());
        }

        if (unitSearch) {
            unitSearch.addEventListener('input', () => applyFilters());
        }

        // Initialize pagination
        updatePagination();
    }

    function applyFilters() {
        const tenantSearch = document.getElementById('tenantSearch').value.toLowerCase();
        const unitSearch = document.getElementById('unitSearch').value.toLowerCase();

        filteredRows = allRows.filter(row => {
            const tenantName = row.querySelector('.tenant-name').textContent.toLowerCase();
            const unitNumber = row.querySelector('.unit-number-cell').textContent.toLowerCase();

            const matchesTenant = tenantSearch === '' || tenantName.includes(tenantSearch);
            const matchesUnit = unitSearch === '' || unitNumber.includes(unitSearch);

            return matchesTenant && matchesUnit;
        });

        currentPage = 1;
        updatePagination();
    }

    function updatePagination() {
        const totalPages = Math.ceil(filteredRows.length / itemsPerPage);
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;

        // Hide all rows first
        allRows.forEach(row => {
            row.style.display = 'none';
            row.classList.add('hidden');
        });

        // Show only rows for current page
        filteredRows.slice(startIndex, endIndex).forEach(row => {
            row.style.display = '';
            row.classList.remove('hidden');
        });

        // Update pagination controls
        const paginationControls = document.getElementById('paginationControls');
        const prevBtn = document.getElementById('prevPageBtn');
        const nextBtn = document.getElementById('nextPageBtn');
        const pageInfo = document.getElementById('pageInfo');

        if (filteredRows.length > itemsPerPage) {
            paginationControls.classList.remove('hidden');

            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;

            pageInfo.textContent = `Page ${currentPage} of ${totalPages} (${filteredRows.length} total units)`;
        } else {
            paginationControls.classList.add('hidden');
        }

        // Update no results message
        const noResultsMessage = document.getElementById('noResultsMessage');
        if (noResultsMessage) {
            if (filteredRows.length === 0 && allRows.length > 0) {
                noResultsMessage.classList.remove('hidden');
            } else {
                noResultsMessage.classList.add('hidden');
            }
        }
    }

    function changePage(direction) {
        const totalPages = Math.ceil(filteredRows.length / itemsPerPage);
        currentPage += direction;

        if (currentPage < 1) currentPage = 1;
        if (currentPage > totalPages) currentPage = totalPages;

        updatePagination();
    }

    function clearSearch(searchId) {
        const searchInput = document.getElementById(searchId);
        if (searchInput) {
            searchInput.value = '';
            applyFilters();
        }
    }

    // =========================================================================
    // UX IMPROVEMENTS: Toast Notifications
    // =========================================================================

    function showToast(message, type = 'success') {
        const toastContainer = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;

        let icon = 'fas fa-check-circle';
        if (type === 'error') icon = 'fas fa-exclamation-circle';
        if (type === 'warning') icon = 'fas fa-exclamation-triangle';

        toast.innerHTML = `
            <i class="${icon}"></i>
            <span>${message}</span>
        `;

        toastContainer.appendChild(toast);

        // Remove toast after animation completes
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 3000);
    }

    // =========================================================================
    // UX IMPROVEMENTS: Filter Table Functionality
    // =========================================================================

    function filterTable(filterType) {
        const filterChips = document.querySelectorAll('.filter-chip');
        const activeChip = document.querySelector(`.filter-chip[onclick*="${filterType}"]`);

        // Update active chip
        filterChips.forEach(chip => chip.classList.remove('active'));
        if (activeChip) {
            activeChip.classList.add('active');
        }

        // Update search filters to reflect this filter
        if (filterType === 'paid') {
            // For paid, we'll filter the already displayed rows
            filteredRows = allRows.filter(row => {
                const indicator = row.querySelector('.indicator');
                const paymentStatus = indicator ? indicator.textContent.trim() : '';
                return paymentStatus === 'âœ“' || paymentStatus === '+';
            });
        } else if (filterType === 'unpaid') {
            filteredRows = allRows.filter(row => {
                const indicator = row.querySelector('.indicator');
                const paymentStatus = indicator ? indicator.textContent.trim() : '';
                return paymentStatus === 'âœ—' || paymentStatus === 'âˆ’';
            });
        } else {
            // 'all' - show all rows
            filteredRows = [...allRows];
        }

        currentPage = 1;
        updatePagination();

        // Show filter applied toast
        if (filterType !== 'all') {
            const filterName = activeChip ? activeChip.textContent.trim() : filterType;
            showToast(`Showing ${filterName.toLowerCase()} tenants`, 'success');
        }
    }

    // =========================================================================
    // UX IMPROVEMENTS: Quick Actions
    // =========================================================================

    function exportData() {
        showToast('Exporting data...', 'warning');
        // In a real app, this would trigger a file download
        setTimeout(() => {
            showToast('Data exported successfully!', 'success');
        }, 1500);
    }

    function showAllPayments() {
        showToast('Loading all payment history...', 'warning');
        // In a real app, this would navigate to payments page
        setTimeout(() => {
            showToast('Payment history loaded', 'success');
        }, 1500);
    }

    function generateReports() {
        showToast('Generating monthly report...', 'warning');
        // In a real app, this would generate and download a report
        setTimeout(() => {
            showToast('Report generated successfully!', 'success');
        }, 2000);
    }

    // =========================================================================
    // UX IMPROVEMENTS: Keyboard Shortcuts
    // =========================================================================

    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + F to focus search
        if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
            e.preventDefault();
            const tenantSearch = document.getElementById('tenantSearch');
            if (tenantSearch) {
                tenantSearch.focus();
                showToast('Search focused. Start typing to filter tenants.', 'info');
            }
        }

        // Escape to clear filters
        if (e.key === 'Escape') {
            clearSearch('tenantSearch');
            clearSearch('unitSearch');
            filterTable('all');
            showToast('Filters cleared', 'info');
        }

        // Ctrl/Cmd + D to toggle dark mode
        if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
            e.preventDefault();
            document.getElementById('dark-mode-toggle').click();
            const isDark = document.body.classList.contains('dark');
            showToast(`Dark mode ${isDark ? 'enabled' : 'disabled'}`, 'success');
        }
    });

    // =========================================================================
    // LOADING STATE MANAGEMENT
    // =========================================================================

    const loadingOverlay = document.getElementById('loadingOverlay');
    const propertyForm = document.getElementById('propertyForm');
    const propertyFormSubmit = document.getElementById('propertyFormSubmit');
    const propertySubmitIcon = document.getElementById('propertySubmitIcon');
    const propertySubmitText = document.getElementById('propertySubmitText');
    const propertySubmitSpinner = document.getElementById('propertySubmitSpinner');

    let isPropertyFormSubmitting = false;

    // Function to show loading state for property form
    function showPropertyFormLoading() {
        isPropertyFormSubmitting = true;

        // Disable form button
        propertyFormSubmit.disabled = true;
        propertyFormSubmit.classList.add('btn-disabled', 'btn-loading');

        // Show spinner and hide icon
        propertySubmitIcon.classList.add('hidden');
        propertySubmitSpinner.classList.remove('hidden');
        propertySubmitText.textContent = 'Loading...';

        // Show loading overlay
        loadingOverlay.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent scrolling
    }

    // Function to hide loading state for property form
    function hidePropertyFormLoading() {
        isPropertyFormSubmitting = false;

        // Re-enable form button
        propertyFormSubmit.disabled = false;
        propertyFormSubmit.classList.remove('btn-disabled', 'btn-loading');

        // Hide spinner and show icon
        propertySubmitIcon.classList.remove('hidden');
        propertySubmitSpinner.classList.add('hidden');
        propertySubmitText.textContent = 'Load Property';

        // Hide loading overlay
        loadingOverlay.classList.remove('active');
        document.body.style.overflow = ''; // Restore scrolling
    }

    // Function to show loading state for modal
    function showModalLoading() {
        const modalSubmitBtn = document.getElementById('modalSubmitBtn');
        const modalSubmitSpinner = document.getElementById('modalSubmitSpinner');
        const btnText = modalSubmitBtn.querySelector('.btn-text');

        if (modalSubmitBtn && modalSubmitSpinner && btnText) {
            modalSubmitBtn.disabled = true;
            modalSubmitBtn.classList.add('btn-disabled');
            modalSubmitSpinner.classList.remove('hidden');
            btnText.textContent = 'Processing...';
        }
    }

    // Function to hide loading state for modal
    function hideModalLoading() {
        const modalSubmitBtn = document.getElementById('modalSubmitBtn');
        const modalSubmitSpinner = document.getElementById('modalSubmitSpinner');
        const btnText = modalSubmitBtn?.querySelector('.btn-text');

        if (modalSubmitBtn && modalSubmitSpinner && btnText) {
            modalSubmitBtn.disabled = false;
            modalSubmitBtn.classList.remove('btn-disabled');
            modalSubmitSpinner.classList.add('hidden');
            btnText.textContent = modalSubmitBtn.classList.contains('bg-red-600') ? 'Unmark Payment' : 'Confirm Payment';
        }
    }

    // =========================================================================
    // DARK MODE FUNCTIONS WITH AJAX
    // =========================================================================

    // AJAX function to send theme preference without page reload
    async function sendThemePreference(theme) {
        try {
            const response = await fetch('http://localhost:7070/page_theme', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `user_theme=${theme}`
            });

            // Don't reload the page, just update local storage
            localStorage.setItem('user_chosen_theme', theme);

            console.log('Theme preference saved:', theme);

        } catch (error) {
            console.error('Error sending theme preference:', error);
            // Fallback: still update local storage even if server request fails
            localStorage.setItem('user_chosen_theme', theme);
        }
    }

    function initializeIcons() {
        const isDark = document.body.classList.contains('dark');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');

        if (sunIcon && moonIcon) {
            if (isDark) {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            } else {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            }
        }
    }

    async function toggleDarkMode() {
        const isCurrentlyDark = document.body.classList.contains('dark');
        const newTheme = isCurrentlyDark ? 'light' : 'dark';

        if (isCurrentlyDark) {
            document.body.classList.remove('dark');
        } else {
            document.body.classList.add('dark');
        }

        initializeIcons();

        // Send preference without page reload using AJAX
        await sendThemePreference(newTheme);
    }

    // =========================================================================
    // GLOBAL FUNCTIONS (Accessible to onclick handlers)
    // =========================================================================

    function closePaymentModal() {
        const paymentModal = document.getElementById('paymentModal');
        if (!paymentModal) return;
        paymentModal.classList.add('hidden');
        paymentModal.classList.remove('flex');
        document.body.classList.remove('modal-open');
        hideModalLoading(); // Reset modal loading state
    }

    function displayErrorBanner(message, isClear = false) {
        const errorDisplay = document.getElementById('paymentErrorDisplay');
        if (!errorDisplay) return;

        if (isClear || !message) {
            errorDisplay.classList.add('hidden');
            errorDisplay.textContent = '';
        } else {
            errorDisplay.textContent = message;
            errorDisplay.classList.remove('hidden');
        }
    }

    // Mobile menu functions
    function openMobileMenu() {
        const sidebar = document.getElementById('sidebar');
        const backdrop = document.getElementById('sidebar-backdrop');
        const mobileMenuButton = document.getElementById('mobile-menu-button');

        if (sidebar) sidebar.classList.add('overlay-visible');
        if (backdrop) backdrop.classList.add('visible');
        if (mobileMenuButton) mobileMenuButton.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
    }

    function closeMobileMenu() {
        const sidebar = document.getElementById('sidebar');
        const backdrop = document.getElementById('sidebar-backdrop');
        const mobileMenuButton = document.getElementById('mobile-menu-button');

        if (sidebar) sidebar.classList.remove('overlay-visible');
        if (backdrop) backdrop.classList.remove('visible');
        if (mobileMenuButton) mobileMenuButton.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
    }

    function toggleMobileMenu() {
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';

        if (isExpanded) {
            closeMobileMenu();
        } else {
            openMobileMenu();
        }
    }

    // =========================================================================
    // FIXED: MODAL FUNCTIONS WITH TENANT_CONTACT PARAMETER
    // =========================================================================

    function openPaymentModal(unit, rent, id, propertyName, tenantContact) {
        console.log('Opening payment modal:', { unit, rent, id, propertyName, tenantContact });

        displayErrorBanner(null, true);

        const modalTitle = document.querySelector('#paymentModal h2');
        if (modalTitle) {
            modalTitle.innerHTML = `<i class="fas fa-money-check-alt text-green-600 mr-2"></i>Record New Payment`;
            modalTitle.classList.remove('text-yellow-600', 'text-red-600');
            modalTitle.classList.add('text-green-600');
        }

        const modalSubmitBtn = document.getElementById('modalSubmitBtn');
        if (modalSubmitBtn) {
            const btnText = modalSubmitBtn.querySelector('.btn-text');
            if (btnText) btnText.textContent = "Confirm Payment";
            modalSubmitBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
            modalSubmitBtn.classList.add('bg-green-600', 'hover:bg-green-700');
        }

        const modalUnit = document.getElementById('modalUnit');
        if (modalUnit) modalUnit.value = unit;

        const modalId = document.getElementById('modalId');
        if (modalId) modalId.value = id;

        const modalPropertyName = document.getElementById('modalPropertyName');
        if (modalPropertyName) modalPropertyName.value = propertyName;

        // SET the tenantContact value - FIXED
        const modalTenantContact = document.getElementById('modalTenantContact');
        if (modalTenantContact) {
            modalTenantContact.value = tenantContact || '';
            console.log('Setting tenant contact:', tenantContact);
        }

        const modalRentInput = document.getElementById('modalRentInput');
        if (modalRentInput) {
            // Clean and set the rent input value
            let cleanRent = rent;
            if (typeof rent === 'string') {
                cleanRent = rent.replace('R ', '').replace(/,/g, '');
            }
            modalRentInput.value = cleanRent;
            modalRentInput.disabled = false;
            modalRentInput.focus();
        }

        const modalUnitDisplay = document.getElementById('modalUnitDisplay');
        if (modalUnitDisplay) modalUnitDisplay.textContent = unit;

        const modalOriginalRent = document.getElementById('modalOriginalRent');
        if (modalOriginalRent) modalOriginalRent.textContent = rent;

        const modalAction = document.getElementById('modalAction');
        if (modalAction) modalAction.value = 'mark';

        const paidInput = document.querySelector('#paymentForm input[name="paid"]');
        if (paidInput) paidInput.value = 'yes';

        const paymentModal = document.getElementById('paymentModal');
        if (paymentModal) {
            paymentModal.classList.remove('hidden');
            paymentModal.classList.add('flex');
            document.body.classList.add('modal-open');
        }
    }

    function openUnmarkModal(unit, id, propertyName, rent, tenantContact) {
        console.log('Opening unmark modal:', { unit, id, propertyName, rent, tenantContact });

        displayErrorBanner(null, true);

        const modalTitle = document.querySelector('#paymentModal h2');
        if (modalTitle) {
            modalTitle.innerHTML = `<i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>Confirm Payment Removal`;
            modalTitle.classList.remove('text-green-600', 'text-red-600');
            modalTitle.classList.add('text-yellow-600');
        }

        const modalSubmitBtn = document.getElementById('modalSubmitBtn');
        if (modalSubmitBtn) {
            const btnText = modalSubmitBtn.querySelector('.btn-text');
            if (btnText) btnText.textContent = "Unmark Payment";
            modalSubmitBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
            modalSubmitBtn.classList.add('bg-red-600', 'hover:bg-red-700');
        }

        const modalUnit = document.getElementById('modalUnit');
        if (modalUnit) modalUnit.value = unit;

        const modalId = document.getElementById('modalId');
        if (modalId) modalId.value = id;

        const modalPropertyName = document.getElementById('modalPropertyName');
        if (modalPropertyName) modalPropertyName.value = propertyName;

        // SET the tenantContact value - FIXED
        const modalTenantContact = document.getElementById('modalTenantContact');
        if (modalTenantContact) {
            modalTenantContact.value = tenantContact || '';
            console.log('Setting tenant contact for unmark:', tenantContact);
        }

        const modalRentInput = document.getElementById('modalRentInput');
        if (modalRentInput) {
            let cleanRent = rent;
            if (typeof rent === 'string') {
                cleanRent = rent.replace('R ', '').replace(/,/g, '');
            }
            modalRentInput.value = cleanRent;
            modalRentInput.disabled = true;
        }

        const modalUnitDisplay = document.getElementById('modalUnitDisplay');
        if (modalUnitDisplay) modalUnitDisplay.textContent = unit;

        const modalOriginalRent = document.getElementById('modalOriginalRent');
        if (modalOriginalRent) modalOriginalRent.textContent = rent;

        const modalAction = document.getElementById('modalAction');
        if (modalAction) modalAction.value = 'unmark';

        const paidInput = document.querySelector('#paymentForm input[name="paid"]');
        if (paidInput) paidInput.value = 'no';

        const paymentModal = document.getElementById('paymentModal');
        if (paymentModal) {
            paymentModal.classList.remove('hidden');
            paymentModal.classList.add('flex');
            document.body.classList.add('modal-open');
        }
    }

    // =========================================================================
    // FIXED: FLASH MESSAGE FUNCTION
    // =========================================================================

    function flashMessage(msg, color = 'green') {
        const el = document.createElement('div');
        el.className = `toast ${color === 'green' ? 'toast-success' : color === 'red' ? 'toast-error' : 'toast-warning'}`;
        el.innerHTML = `
            <i class="fas fa-${color === 'green' ? 'check-circle' : color === 'red' ? 'exclamation-circle' : 'exclamation-triangle'}"></i>
            <span>${msg}</span>
        `;

        document.getElementById('toastContainer').appendChild(el);

        setTimeout(() => {
            if (el.parentNode) {
                el.parentNode.removeChild(el);
            }
        }, 3000);
    }

    // =========================================================================
    // DOMContentLoaded Event Listener
    // =========================================================================

    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM fully loaded and parsed');

        // Use server theme as primary source
        const serverTheme = window.serverTheme || 'light';
        localStorage.setItem('user_chosen_theme', serverTheme);
        initializeIcons();

        // Initialize table pagination and search
        setTimeout(() => {
            initializeTablePagination();
        }, 100);

        // Add event listener to dark mode toggle button
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        if (darkModeToggle) {
            darkModeToggle.addEventListener('click', async function(event) {
                event.preventDefault();
                event.stopPropagation();
                await toggleDarkMode();
            });
        }

        // Mobile menu button functionality
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        if (mobileMenuButton) {
            mobileMenuButton.addEventListener('click', toggleMobileMenu);
        }

        // Close mobile menu when clicking backdrop
        const backdrop = document.getElementById('sidebar-backdrop');
        if (backdrop) {
            backdrop.addEventListener('click', closeMobileMenu);
        }

        // Close mobile menu when clicking on sidebar links
        const sidebarLinks = document.querySelectorAll('.sidebar a');
        sidebarLinks.forEach(link => {
            link.addEventListener('click', closeMobileMenu);
        });

        // Close mobile menu on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeMobileMenu();
            }
        });

        // Close mobile menu on window resize above 1024px
        window.addEventListener('resize', function() {
            if (window.innerWidth > 1024) {
                closeMobileMenu();
            }
        });

        // View Units Table button functionality (toggles property selection panel)
        const viewTableBtn = document.getElementById('viewTableBtn');
        const propertyFormContainer = document.getElementById('propertyFormContainer');
        const mainContent = document.getElementById('mainContent');

        if (viewTableBtn && propertyFormContainer && mainContent) {
            viewTableBtn.addEventListener('click', function() {
                // Toggle property form visibility
                propertyFormContainer.classList.toggle('hidden');

                // Toggle button text based on state
                if (propertyFormContainer.classList.contains('hidden')) {
                    viewTableBtn.innerHTML = `
                        <i class="fas fa-chevron-left mr-2"></i>
                        Show Property Selection
                    `;
                    mainContent.classList.add('full-table-view');
                } else {
                    viewTableBtn.innerHTML = `
                        <i class="fas fa-table mr-2"></i>
                        View Units Table
                    `;
                    mainContent.classList.remove('full-table-view');
                }
            });
        }

        // Format and display the current date
        function formatDate() {
            const date = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = date.toLocaleDateString('en-US', options);
            document.getElementById('currentDate').textContent = formattedDate;
        }
        formatDate();

        // Initialize payment handlers
        initializePaymentHandlers();

        // =========================================================================
        // PROPERTY FORM SUBMISSION WITH LOADING
        // =========================================================================
        const propertySelect = document.getElementById('propertySelect');
        let autoSubmitted = false;

        if (propertyForm && propertyFormSubmit) {
            // Handle form submission
            propertyForm.addEventListener('submit', function(event) {
                // Prevent multiple submissions
                if (isPropertyFormSubmitting) {
                    event.preventDefault();
                    return false;
                }

                const selectedValue = propertySelect.value;
                if (selectedValue && selectedValue !== '' && selectedValue !== 'all') {
                    showPropertyFormLoading();
                    return true;
                }

                // If no property selected, don't submit
                event.preventDefault();
                return false;
            });

            // Auto-submit when property is selected (with loading)
            const selectedValue = propertySelect.value;
            if (selectedValue && selectedValue !== '' && selectedValue !== 'all' && !autoSubmitted) {
                autoSubmitted = true;
                showPropertyFormLoading();
                // Allow the form to submit normally
            }

            // Handle select change with loading
            propertySelect.addEventListener('change', function() {
                const newValue = this.value;
                if (newValue && newValue !== '' && newValue !== 'all') {
                    showPropertyFormLoading();
                    propertyForm.submit();
                }
            });
        }

        // =========================================================================
        // FIXED: ASYNCHRONOUS PAYMENT SUBMISSION HANDLER
        // =========================================================================

// =========================================================================
// FIXED: ASYNCHRONOUS PAYMENT SUBMISSION HANDLER WITH DEBT STATUS UPDATE
// =========================================================================

const paymentForm = document.getElementById('paymentForm');
if (paymentForm) {
    paymentForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        displayErrorBanner(null, true);

        // Show loading on modal submit button
        showModalLoading();

        const formData = new FormData(paymentForm);
        const tenantName = formData.get('id');
        const unit = formData.get('unit');
        const tenantContact = formData.get('tenant_contact');
        const actionType = formData.get('action_type');

        console.log('Payment form submitted:', {
            tenantName,
            unit,
            tenantContact,
            actionType
        });

        let url = "";

        // Include tenantContact in both URLs
        if (actionType === 'unmark') {
            url = `http://localhost:7070/unmark_payment/${tenantName}/${unit}/${tenantContact}`;
        } else {
            url = `http://localhost:7070/payment_status/${tenantName}/${unit}/${tenantContact}`;
        }

        try {
            const response = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: new URLSearchParams(formData)
            });

            // Hide loading after response
            hideModalLoading();

            if (!response.ok) {
                const errorMessage = await response.text();
                displayErrorBanner(errorMessage || "Something went wrong.");
                return;
            }

            // Parse JSON response
            let data;
            try {
                data = await response.json();
                console.log('Server response:', data);
            } catch (jsonError) {
                console.error('JSON parsing error:', jsonError);
                displayErrorBanner('Invalid server response.');
                return;
            }

            // Check if we have a valid response
            if (!data) {
                displayErrorBanner('No data received from server.');
                return;
            }

            // Update payment indicator
            const rowIndicator = document.querySelector(
                `.indicator[data-unit="${unit}"][data-id="${tenantName}"]`
            );

            if (rowIndicator) {
                if (actionType === 'unmark') {
                    rowIndicator.textContent = "âœ—";
                    rowIndicator.classList.remove("bg-green-100", "text-green-800");
                    rowIndicator.classList.add("bg-red-100", "text-red-800");
                } else {
                    rowIndicator.textContent = "âœ“";
                    rowIndicator.classList.remove("bg-red-100", "text-red-800");
                    rowIndicator.classList.add("bg-green-100", "text-green-800");
                }
            }

            // ============================================
            // NEW: UPDATE DEBT STATUS FROM SERVER RESPONSE
            // ============================================
            if (data.debt_status !== null && data.debt_status !== undefined) {
                console.log('Updating debt display with value:', data.debt_status);
                updateDebtDisplay(unit, data.debt_status);
            }

            flashMessage(
                actionType === 'unmark'
                ? `Payment removed for Unit ${unit}.`
                : `Payment recorded for Unit ${unit}.`,
                "green"
            );

            closePaymentModal();

            // Re-initialize table to reflect changes
            setTimeout(() => {
                initializeTablePagination();
            }, 500);

        } catch (error) {
            console.error("AJAX Error:", error);
            displayErrorBanner("Network error. Check your connection.");
            hideModalLoading();
        }
    });
}

// =========================================================================
// FIXED: Update Debt Status Function - CORRECTED VERSION
// =========================================================================

function updateDebtDisplay(unit, debtAmount) {
    console.log('ðŸ”„ updateDebtDisplay called with:', {
        unit,
        debtAmount,
        type: typeof debtAmount
    });

    // Format the debt amount
    const debtAmountNum = parseFloat(debtAmount);
    const formattedDebt = formatCurrency(debtAmount);

    // ============================================
    // FIXED: Find the row using the indicator's data-unit
    // ============================================

    // Find the indicator first, then its parent row
    const indicator = document.querySelector(`.indicator[data-unit="${unit}"]`);

    if (!indicator) {
        console.error('âŒ Indicator not found for unit:', unit);
        console.log('Available indicators:',
            Array.from(document.querySelectorAll('.indicator[data-unit]'))
                .map(el => ({ unit: el.dataset.unit, id: el.dataset.id }))
        );
        return;
    }

    // Find the parent row
    const row = indicator.closest('.tenant-row');

    if (!row) {
        console.error('âŒ Row not found for indicator:', indicator);
        return;
    }

    console.log('âœ… Found row via indicator:', row);

    // ============================================
    // Update the debt element
    // ============================================
    const debtElement = row.querySelector('.tenant-contact.status-badge');

    if (!debtElement) {
        console.error('âŒ Debt element not found in row');
        return;
    }

    console.log('âœ… Found debt element:', debtElement);

    // UPDATE THE data-tenant-contact ATTRIBUTE with the debt value
    debtElement.setAttribute('data-tenant-contact', debtAmount);
    console.log('âœ… Set data-tenant-contact to:', debtAmount);

    // Update the text content based on the debt amount
    if (debtAmountNum > 0) {
        debtElement.innerHTML = `
            <i class="fas fa-phone mr-1"></i>
            Debt: ${formattedDebt}
        `;
        debtElement.classList.remove('status-active');
        debtElement.classList.add('status-vacant');
        debtElement.title = `Outstanding debt: ${formattedDebt}`;
    } else {
        debtElement.innerHTML = `
            <i class="fas fa-phone mr-1"></i>
            No Debt
        `;
        debtElement.classList.remove('status-vacant');
        debtElement.classList.add('status-active');
        debtElement.title = 'No outstanding debt';
    }

    console.log('âœ… Updated debt display:', debtElement.innerHTML);
}

// =========================================================================
// Helper function for currency formatting
// =========================================================================

function formatCurrency(amount) {
    const numAmount = parseFloat(amount);
    if (isNaN(numAmount)) {
        console.warn('âš ï¸ Cannot format amount:', amount);
        return 'R 0.00';
    }

    return 'R ' + numAmount.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
}
        // =========================================================================
        // EVENT LISTENERS FOR TABLE INTERACTIONS
        // =========================================================================

        let selectedRow = null;
        const rows = document.querySelectorAll('.tenant-row');

        rows.forEach(row => {
            row.addEventListener('click', (e) => {
                if (e.target.closest('.indicator')) return;
                if (e.target.closest('a')) return; // Don't select row when clicking edit link
                if (e.target.closest('.payment-cell')) return;

                if (selectedRow) selectedRow.classList.remove('row-selected');
                selectedRow = row;
                selectedRow.classList.add('row-selected');
            });
        });

        // Handle page unload to prevent accidental navigation during form submission
        window.addEventListener('beforeunload', function(e) {
            if (isPropertyFormSubmitting) {
                // Optional: Show confirmation dialog
                // e.preventDefault();
                // e.returnValue = 'Your form is still submitting. Are you sure you want to leave?';
            }
        });

        // Initial Load Actions
        displayErrorBanner(null, true);
    });

    // =========================================================================
    // FIXED: PAYMENT CELL CLICK HANDLING
    // =========================================================================

    function initializePaymentHandlers() {
        // Use event delegation for better performance
        const unitsTbody = document.getElementById('unitsTbody');

        if (unitsTbody) {
            // Handle payment cell clicks
            unitsTbody.addEventListener('click', function(e) {
                const indicator = e.target.closest('.indicator');

                if (indicator) {
                    e.stopPropagation();

                    // Get the data from the indicator
                    const currentStatus = indicator.textContent.trim();
                    const unit = indicator.dataset.unit;
                    const rent = indicator.dataset.rent;
                    const id = indicator.dataset.id;
                    const propertyName = indicator.dataset.propertyName;
                    const tenantContact = indicator.dataset.tenantContact;

                    console.log('Payment indicator clicked:', {
                        currentStatus,
                        unit,
                        rent,
                        id,
                        propertyName,
                        tenantContact
                    });

                    // Check if the unit is vacant (has ban icon)
                    const isVacant = indicator.querySelector('.fa-ban');
                    if (isVacant) {
                        showToast('This unit is vacant. No payment actions available.', 'warning');
                        return;
                    }

                    // Determine which modal to open based on current status
                    if (currentStatus === 'âœ“' || currentStatus === '+') {
                        // Already paid - open unmark modal
                        openUnmarkModal(unit, id, propertyName, rent, tenantContact);
                    } else if (currentStatus === 'âœ—' || currentStatus === 'âˆ’') {
                        // Not paid - open mark as paid modal
                        openPaymentModal(unit, rent, id, propertyName, tenantContact);
                    } else {
                        // Default to mark as paid
                        openPaymentModal(unit, rent, id, propertyName, tenantContact);
                    }
                }
            });

            console.log('Payment handlers initialized');
        }
    }
</script>
</body>
</html>