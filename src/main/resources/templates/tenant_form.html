<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ProMan — Add Tenant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root{
            --brand: #8B5E3C;
            --brand-dark: #70472E;
            --accent: #D9CBB8;
            --card-bg: #FAF3E0;
            --pill-bg: #FFF8E7;
            --brand-weak: #E7D9CC;
        }

        /* small helper visuals */
        .toast {
            position: fixed;
            right: 1rem;
            top: 1rem;
            z-index: 60;
            padding: .6rem 1rem;
            border-radius: .5rem;
            box-shadow: 0 8px 24px rgba(16,24,40,0.12);
            font-weight: 600;
        }

        /* subtle required star */
        .required-star { color: #dc2626; margin-left: 0.15rem; }

        /* small input error */
        .input-error { color: #dc2626; font-size: 0.85rem; margin-top: .25rem; display: none; }

        /* visually emphasize primary action */
        .btn-primary { background: var(--brand); }
        .btn-primary:hover { background: var(--brand-dark); }

        /* keep logo size consistent */
        .logo-img { height: 56px; width: auto; display: block; }

        /* accessible focus rings */
        input:focus, select:focus, button:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(139,94,60,0.12);
            border-color: var(--brand);
        }

        /* Progress / stepper */
        .progress-dot {
            width: 14px;
            height: 14px;
            border-radius: 9999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            transition: transform .18s ease, box-shadow .18s ease;
        }
        .progress-sep {
            height: 3px;
            border-radius: 3px;
            flex: 0 0 56px;
        }

        /* Completed and active states */
        .step-complete .progress-dot { background: var(--brand); box-shadow: 0 6px 14px rgba(139,94,60,0.14); }
        .step-complete .progress-label { color: #374151; font-weight: 600; }
        .step-active .progress-dot {
            background: var(--brand);
            box-shadow: 0 10px 26px rgba(139,94,60,0.22);
            border: 3px solid rgba(255,255,255,0.22);
            width: 28px;
            height: 28px;
            font-size: 12px;
            transform: translateY(-2px);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .step-active .progress-label { color: var(--brand); font-weight: 700; }

        /* subtle pulse to draw attention to active dot */
        @keyframes pulse {
            0% { box-shadow: 0 10px 26px rgba(139,94,60,0.18); transform: translateY(-2px) scale(1); }
            50% { box-shadow: 0 18px 40px rgba(139,94,60,0.12); transform: translateY(-3px) scale(1.04); }
            100% { box-shadow: 0 10px 26px rgba(139,94,60,0.18); transform: translateY(-2px) scale(1); }
        }
        .step-active .progress-dot {
            animation: pulse 2200ms ease-in-out infinite;
        }

        /* responsive tweaks */
        @media (max-width: 640px) {
            .progress-sep { flex-basis: 28px; }
            .step-active .progress-dot { width: 22px; height: 22px; font-size: 11px; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased">

<!-- Header / Navbar -->
<header class="bg-white shadow-sm sticky top-0 z-30">
    <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
        <a href="home.html" class="flex items-center gap-4" aria-label="ProMan home">
            <img src="/umuzi/img/mypromann.png" alt="ProMan logo" class="logo-img">
            <div class="leading-tight">
                <div class="text-lg md:text-xl font-extrabold text-[var(--brand)]">ProMan</div>
                <div class="text-xs text-gray-500 -mt-1">Property management simplified</div>
            </div>
        </a>

        <nav class="hidden sm:flex items-center space-x-6 text-gray-600" aria-label="Main navigation">
            <a href="home.html" class="hover:text-[var(--brand)] transition">Home</a>
            <a href="dashboard.html" class="hover:text-[var(--brand)] transition">Dashboard</a>
            <a href="signup.html" class="hover:text-[var(--brand)] transition">Sign Up</a>
            <a href="login.html" class="hover:text-[var(--brand)] transition">Login</a>
        </nav>
    </div>
</header>

<main class="max-w-6xl mx-auto px-6 py-10">

    <!-- Top info card with Thymeleaf placeholders preserved -->
    <div class="max-w-3xl mx-auto mb-6">
        <div class="bg-[var(--brand)] text-white p-5 rounded-lg shadow-md">
            <div class="flex items-start justify-between">
                <div>
                    <h2 class="text-xl font-semibold" th:text="'Add tenant'">Add tenant</h2>
                    <p class="text-sm mt-1" th:text="'Unit ' + ${unit_add}">Unit 1</p>
                </div>
                <div class="text-right">
                    <a href="http://localhost:7070/add_property_unit" class="text-sm bg-white/10 px-3 py-1 rounded-md inline-block hover:bg-white/20">Back</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress / stepper: Account & Add Unit complete, Add Tenant highlighted -->
    <div class="max-w-3xl mx-auto mb-6">
        <div class="flex items-center justify-center gap-4 px-4 py-2">
            <div class="flex items-center gap-3">
                <!-- Account (completed) -->
                <div class="flex flex-col items-center step-complete" title="Account completed">
                    <div class="progress-dot" aria-hidden="true">
                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M20 6L9 17l-5-5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="progress-label text-sm mt-2">Account</div>
                </div>

                <div class="progress-sep bg-[var(--brand-weak)]" aria-hidden="true"></div>

                <!-- Add Unit (completed) -->
                <div class="flex flex-col items-center step-complete" title="Add Unit completed">
                    <div class="progress-dot" aria-hidden="true">
                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M20 6L9 17l-5-5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="progress-label text-sm mt-2">ADD UNIT</div>
                </div>

                <div class="progress-sep bg-[var(--brand-weak)]" aria-hidden="true"></div>

                <!-- Add Tenant (active) -->
                <div class="flex flex-col items-center step-active" title="Add Tenant (current step)">
                    <div class="progress-dot" aria-current="step" aria-hidden="true">3</div>
                    <div class="progress-label text-sm mt-2">add Tenant</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Form card -->
    <section class="max-w-3xl mx-auto bg-white rounded-2xl p-8 border border-[var(--accent)] shadow form-card">
        <h3 class="text-2xl font-extrabold text-[var(--brand)] mb-4 text-center">Add Tenant</h3>

        <form id="tenantForm" action="http://localhost:7070/add_tenants" th:action="@{/add_tenants}" method="POST" class="space-y-4" novalidate>
            <!-- NAME -->
            <div>
                <label for="tenant_name" class="block text-sm font-medium text-gray-700">Full name <span class="required-star">*</span></label>
                <input id="tenant_name" name="tenant_name" type="text" required
                       placeholder="e.g. Thabo Ndlovu"
                       class="mt-1 block w-full rounded-md border border-gray-200 bg-[var(--pill-bg)] px-3 py-2" />
                <div id="tenant_name_error" class="input-error">Please enter the tenant's full name.</div>
            </div>

            <!-- PHONE and MOVE-IN (side-by-side on wide screens) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="cell_number" class="block text-sm font-medium text-gray-700">Phone number <span class="required-star">*</span></label>
                    <input id="cell_number" name="cell_number" type="tel" pattern="[0-9]{7,15}" placeholder="e.g. 0712345678" required
                           class="mt-1 block w-full rounded-md border border-gray-200 px-3 py-2" />
                    <div id="cell_number_error" class="input-error">Enter a valid phone number (7–15 digits).</div>
                    <p class="text-xs text-gray-500 mt-1">No spaces or symbols. Country code optional (e.g. 2781...)</p>
                </div>

                <div>
                    <label for="move_in" class="block text-sm font-medium text-gray-700">Move-in date <span class="required-star">*</span></label>
                    <input id="move_in" name="move_in" type="date" required class="mt-1 block w-full rounded-md border border-gray-200 px-3 py-2 bg-white" />
                    <div id="move_in_error" class="input-error">Please select a move-in date.</div>
                    <p class="text-xs text-gray-500 mt-1">You can change this later if needed.</p>
                </div>
            </div>

            <!-- EMPLOYMENT -->
            <div>
                <div class="flex items-center justify-between">
                    <label class="block text-sm font-medium text-gray-700">Employment <span class="required-star">*</span></label>
                    <button type="button" id="employmentHelpBtn" aria-label="Employment help" class="text-xs text-gray-500 hover:underline">Why we ask</button>
                </div>
                <div class="mt-2 flex items-center gap-6" role="radiogroup" aria-labelledby="employment-label">
                    <label class="inline-flex items-center gap-2">
                        <input type="radio" name="employment" value="yes" required class="h-4 w-4 text-[var(--brand)]">
                        <span class="text-sm text-gray-700">Yes</span>
                    </label>
                    <label class="inline-flex items-center gap-2">
                        <input type="radio" name="employment" value="no" class="h-4 w-4 text-[var(--brand)]">
                        <span class="text-sm text-gray-700">No</span>
                    </label>
                </div>
                <div id="employment_error" class="input-error">Please indicate employment status.</div>
            </div>

            <!-- NEXT OF KIN -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="kin_name" class="block text-sm font-medium text-gray-700">Next of kin name</label>
                    <input id="kin_name" name="kin_name" type="text" placeholder="e.g. Naledi Mokoena"
                           class="mt-1 block w-full rounded-md border border-gray-200 px-3 py-2" />
                </div>

                <div>
                    <label for="kin_number" class="block text-sm font-medium text-gray-700">Next of kin phone</label>
                    <input id="kin_number" name="kin_number" type="tel" pattern="[0-9]{7,15}" placeholder="e.g. 0712345678"
                           class="mt-1 block w-full rounded-md border border-gray-200 px-3 py-2" />
                    <div id="kin_number_error" class="input-error">Enter a valid phone number (7–15 digits) or leave blank.</div>
                </div>
            </div>
            <!-- RENT & DEBT (Side by Side at Bottom) -->
            <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="rent_day" class="block text-sm font-medium text-gray-700">
                        Rent day
                    </label>
                    <input id="rent_day" name="rent_payment_day" type="number" placeholder="8"
                           class="mt-1 block w-full rounded-md border border-gray-200 px-3 py-2" required/>
                </div>

                <div>
                    <label for="debt" class="block text-sm font-medium text-gray-700">
                        Outstanding debt
                    </label>
                    <input id="debt" name="debt" type="text" placeholder="e.g. R200"
                           class="mt-1 block w-full rounded-md border border-gray-200 px-3 py-2" required/>
                </div>
            </div>


            <!-- Form actions -->
            <div class="flex items-center gap-3 pt-2">
                <button id="submitBtn" type="submit" class="btn-primary text-white px-4 py-3 rounded-lg font-semibold flex-1">
                    Add Tenant
                </button>
                <a href="dashboard.html" class="px-4 py-3 rounded-lg border border-gray-200 text-sm text-gray-700 inline-flex items-center justify-center">Cancel</a>
            </div>

            <!-- hidden field preserving unit context (optional) -->
            <input type="hidden" name="unit" th:value="${unit_add}" />
        </form>
    </section>
</main>

<!-- Footer -->
<footer class="mt-12 py-8 bg-white border-t">
    <div class="max-w-6xl mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-6 text-sm text-gray-600">
        <div>
            <a href="home.html" class="text-lg font-extrabold text-[var(--brand)]">ProMan</a>
            <p class="text-sm text-gray-500 mt-2">Make property management simple and reliable.</p>
        </div>

        <div class="flex flex-col">
            <h4 class="font-semibold text-gray-700 mb-2">Product</h4>
            <a href="dashboard.html" class="text-sm text-gray-600 hover:underline">Dashboard</a>
            <a href="signup.html" class="text-sm text-gray-600 hover:underline mt-1">Sign Up</a>
            <a href="login.html" class="text-sm text-gray-600 hover:underline mt-1">Login</a>
        </div>

        <div class="text-right md:text-left">
            <div>© ProMan — Property Management</div>
            <a href="mailto:ProMan@gmail.com" class="text-[var(--brand)] hover:underline">ProMan@gmail.com</a>
        </div>
    </div>
</footer>

<!-- Toast container -->
<div id="toastContainer" aria-live="polite" aria-atomic="true"></div>

<script>
    (function() {
        const form = document.getElementById('tenantForm');
        const submitBtn = document.getElementById('submitBtn');
        const toastContainer = document.getElementById('toastContainer');

        const showError = (id, msg) => {
            const el = document.getElementById(id);
            if (!el) return;
            el.textContent = msg;
            el.style.display = 'block';
        };
        const hideError = (id) => {
            const el = document.getElementById(id);
            if (!el) return;
            el.style.display = 'none';
        };

        const nameInput = document.getElementById('tenant_name');
        const phoneInput = document.getElementById('cell_number');
        const moveInInput = document.getElementById('move_in');
        const kinPhoneInput = document.getElementById('kin_number');

        function employmentSelected() {
            const radios = form.querySelectorAll('input[name="employment"]');
            return Array.from(radios).some(r => r.checked);
        }

        function validate() {
            let ok = true;

            if (!nameInput.value.trim()) {
                showError('tenant_name_error', "Please enter the tenant's full name.");
                ok = false;
            } else {
                hideError('tenant_name_error');
            }

            const phoneVal = phoneInput.value.replace(/\D/g,'');
            if (!/^\d{7,15}$/.test(phoneVal)) {
                showError('cell_number_error', 'Enter a valid phone number (7–15 digits).');
                ok = false;
            } else {
                hideError('cell_number_error');
            }

            if (!moveInInput.value) {
                showError('move_in_error', 'Please select a move-in date.');
                ok = false;
            } else {
                hideError('move_in_error');
            }

            const kinVal = kinPhoneInput.value.replace(/\D/g,'');
            if (kinPhoneInput.value && !/^\d{7,15}$/.test(kinVal)) {
                showError('kin_number_error', 'Enter a valid phone number (7–15 digits) or clear the field.');
                ok = false;
            } else {
                hideError('kin_number_error');
            }

            if (!employmentSelected()) {
                showError('employment_error', 'Please indicate employment status.');
                ok = false;
            } else {
                hideError('employment_error');
            }

            return ok;
        }

        function showToast(msg, opts = {}) {
            const el = document.createElement('div');
            el.className = 'toast';
            el.style.background = opts.bg || '#fff3cd';
            el.style.color = opts.color || '#92400e';
            el.textContent = msg;
            toastContainer.appendChild(el);
            setTimeout(() => { el.remove(); }, opts.duration || 1800);
        }

        document.getElementById('employmentHelpBtn').addEventListener('click', () => {
            showToast('We ask about employment to better assess affordability and provide faster reference checks.', { bg: '#eef2ff', color: '#3730a3', duration: 3000 });
        });

        function normalizeDigits(e) {
            const start = e.target.selectionStart;
            const raw = e.target.value;
            const digits = raw.replace(/[^\d]/g, '');
            e.target.value = digits;
            try { e.target.setSelectionRange(start, start); } catch (err) {}
        }
        phoneInput.addEventListener('input', normalizeDigits);
        kinPhoneInput.addEventListener('input', normalizeDigits);

        form.addEventListener('submit', function(evt) {
            if (!validate()) {
                evt.preventDefault();
                showToast('Please fix the highlighted fields', { bg: '#ffe4e6', color: '#991b1b' });
                return;
            }

            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-80', 'cursor-not-allowed');
            showToast('Submitting…', { bg: '#dcfce7', color: '#064e3b', duration: 2000 });

            setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-80', 'cursor-not-allowed');
            }, 5000);
        });

        [nameInput, phoneInput, moveInInput, kinPhoneInput].forEach(inp => {
            inp.addEventListener('blur', validate);
        });
        form.querySelectorAll('input[name="employment"]').forEach(r => r.addEventListener('change', validate));
    })();
</script>
</body>
</html>